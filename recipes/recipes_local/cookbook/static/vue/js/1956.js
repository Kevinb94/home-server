"use strict";(self["webpackChunktandoor"]=self["webpackChunktandoor"]||[]).push([[1956,1868,3448],{36502:function(t,e,a){a.d(e,{YI:function(){return n},vp:function(){return s}});var i=a(5121),o=a(49665);a(6955);function s(t){let e=(0,o.resolveDjangoUrl)("api:recipe-detail",t);return void 0!==window.SHARE_UID&&"None"!==window.SHARE_UID&&(e+="?share="+window.SHARE_UID),i.Z.get(e).then((t=>t.data)).catch((t=>{r(t,"There was an error loading a resource!","danger")}))}function n(t){return i.Z.post((0,o.resolveDjangoUrl)("api:cooklog-list"),t).then((t=>{(0,o.makeToast)("Saved","Cook Log entry saved!","success")})).catch((t=>{r(t,"There was an error creating a resource!","danger")}))}function r(t,e){if("response"in t){console.log(t.response);let a="statusText"in t.response?t.response.statusText:(0,o.djangoGettext)("Error");e+="\n\n"+JSON.stringify(t.response.data),(0,o.makeToast)(a,e,"danger")}else(0,o.makeToast)("Error",e,"danger"),console.log(t)}i.Z.defaults.xsrfCookieName="csrftoken",i.Z.defaults.xsrfHeaderName="X-CSRFTOKEN"},87503:function(t,e,a){a.r(e),a.d(e,{default:function(){return m}});var i=function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{staticClass:"modal",attrs:{id:`id_modal_cook_log_${t.modal_id}`,title:t.$t("Log_Recipe_Cooking"),"ok-title":t.$t("Save"),"cancel-title":t.$t("Close")},on:{ok:function(e){return t.logCook()}}},[e("p",[t._v(t._s(t.$t("all_fields_optional")))]),e("form",[e("label",{attrs:{for:"id_log_servings"}},[t._v(t._s(t.$t("Servings")))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.logObject.servings,expression:"logObject.servings"}],staticClass:"form-control",attrs:{type:"number",id:"id_log_servings"},domProps:{value:t.logObject.servings},on:{input:function(e){e.target.composing||t.$set(t.logObject,"servings",e.target.value)}}}),e("label",{staticStyle:{"margin-top":"2vh"}},[t._v(t._s(t.$t("Rating"))+" - "),e("span",{attrs:{id:"id_rating_show"}},[t._v(t._s(t.logObject.rating)+"/5")])]),e("b-form-rating",{model:{value:t.logObject.rating,callback:function(e){t.$set(t.logObject,"rating",e)},expression:"logObject.rating"}}),e("label",{staticStyle:{"margin-top":"2vh"},attrs:{for:"id_date"}},[t._v(t._s(t.$t("Date")))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.logObject.created_at,expression:"logObject.created_at"}],staticClass:"form-control",attrs:{type:"datetime-local",id:"id_date"},domProps:{value:t.logObject.created_at},on:{input:function(e){e.target.composing||t.$set(t.logObject,"created_at",e.target.value)}}})],1)])],1)},o=[],s=a(30381),n=a.n(s),r=a(70538),d=a(12120),l=a(36502);r["default"].prototype.moment=n(),r["default"].use(d.XG7);var c={name:"CookLog",props:{recipe:Object,modal_id:Number},data(){return{logObject:{recipe:this.recipe.id,servings:0,rating:0,created_at:n()().format("yyyy-MM-DDTHH:mm")}}},methods:{logCook:function(){(0,l.YI)(this.logObject)}}},p=c,_=a(1001),h=(0,_.Z)(p,i,o,!1,null,null,null),m=h.exports},11072:function(t,e,a){a.r(e),a.d(e,{default:function(){return g}});var i=function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{staticClass:"modal",attrs:{id:`id_modal_add_book_${t.modal_id}`,title:t.$t("Manage_Books"),"ok-title":t.$t("Add"),"cancel-title":t.$t("Close")},on:{ok:function(e){return t.addToBook()},shown:t.loadBookEntries}},[e("ul",{staticClass:"list-group"},t._l(this.recipe_book_list,(function(a){return e("li",{key:a.id,staticClass:"list-group-item d-flex justify-content-between align-items-center"},[t._v(" "+t._s(a.book_content.name)+" "),e("span",{staticClass:"btn btn-sm btn-danger",on:{click:function(e){return t.removeFromBook(a)}}},[e("i",{staticClass:"fa fa-trash-alt"})])])})),0),e("multiselect",{staticStyle:{"margin-top":"1vh"},attrs:{options:t.books_filtered,taggable:!0,"tag-placeholder":t.$t("Create"),placeholder:t.$t("Select_Book"),label:"name","track-by":"id",id:"id_books",multiple:!1,loading:t.books_loading},on:{tag:t.createBook,"search-change":t.loadBooks},model:{value:t.selected_book,callback:function(e){t.selected_book=e},expression:"selected_book"}})],1)],1)},o=[],s=(a(57658),a(47907)),n=a.n(s),r=a(30381),d=a.n(r),l=a(70538),c=a(12120),p=a(6955),_=a(49665);l["default"].prototype.moment=d(),l["default"].use(c.XG7);var h={name:"AddRecipeToBook",components:{Multiselect:n()},props:{recipe:Object,modal_id:Number},data(){return{books:[],books_loading:!1,recipe_book_list:[],selected_book:null}},computed:{books_filtered:function(){let t=[];return this.books.forEach((e=>{0===this.recipe_book_list.filter((t=>t.book===e.id)).length&&t.push(e)})),t}},mounted(){},methods:{loadBooks:function(t){this.books_loading=!0;let e=new p.ApiApiFactory;e.listRecipeBooks({query:{query:t}}).then((t=>{this.books=t.data.filter((t=>-1===this.recipe_book_list.indexOf(t))),this.books_loading=!1}))},createBook:function(t){let e=new p.ApiApiFactory;e.createRecipeBook({name:t}).then((t=>{this.books.push(t.data),this.selected_book=t.data,_.StandardToasts.makeStandardToast(this,_.StandardToasts.SUCCESS_CREATE)}))},addToBook:function(){let t=new p.ApiApiFactory;t.createRecipeBookEntry({book:this.selected_book.id,recipe:this.recipe.id}).then((t=>{this.recipe_book_list.push(t.data),_.StandardToasts.makeStandardToast(this,_.StandardToasts.SUCCESS_CREATE)})).catch((t=>{_.StandardToasts.makeStandardToast(this,_.StandardToasts.FAIL_UPDATE,t)}))},removeFromBook:function(t){let e=new p.ApiApiFactory;e.destroyRecipeBookEntry(t.id).then((e=>{this.recipe_book_list=this.recipe_book_list.filter((e=>e.id!==t.id)),_.StandardToasts.makeStandardToast(this,_.StandardToasts.SUCCESS_DELETE)}))},loadBookEntries:function(){let t=new p.ApiApiFactory;t.listRecipeBookEntrys({query:{recipe:this.recipe.id}}).then((t=>{this.recipe_book_list=t.data,this.loadBooks("")}))}}},m=h,u=a(1001),f=(0,u.Z)(m,i,o,!1,null,null,null),g=f.exports},21956:function(t,e,a){a.r(e),a.d(e,{default:function(){return b}});var i=function(){var t=this,e=t._self._c;return e("div",[e("div",{staticClass:"dropdown d-print-none"},[t._m(0),e("div",{staticClass:"dropdown-menu dropdown-menu-right",attrs:{"aria-labelledby":"dropdownMenuLink"}},[t.disabled_options.edit?t._e():e("a",{staticClass:"dropdown-item",attrs:{href:t.resolveDjangoUrl("edit_recipe",t.recipe.id)}},[e("i",{staticClass:"fas fa-pencil-alt fa-fw"}),t._v(" "+t._s(t.$t("Edit")))]),t.disabled_options.edit?t._e():e("a",{staticClass:"dropdown-item",attrs:{href:t.resolveDjangoUrl("view_property_editor",t.recipe.id)}},[e("i",{staticClass:"fas fa-table"}),t._v(" "+t._s(t.$t("Property_Editor")))]),t.recipe.internal||t.disabled_options.convert?t._e():e("a",{staticClass:"dropdown-item",attrs:{href:t.resolveDjangoUrl("edit_convert_recipe",t.recipe.id)}},[e("i",{staticClass:"fas fa-exchange-alt fa-fw"}),t._v(" "+t._s(t.$t("convert_internal")))]),e("a",{attrs:{href:"javascript:void(0);"}},[t.disabled_options.books?t._e():e("button",{staticClass:"dropdown-item",on:{click:function(e){return t.$bvModal.show(`id_modal_add_book_${t.modal_id}`)}}},[e("i",{staticClass:"fas fa-bookmark fa-fw"}),t._v(" "+t._s(t.$t("Manage_Books"))+" ")])]),t.recipe.internal&&!t.disabled_options.shopping?e("a",{staticClass:"dropdown-item",attrs:{href:"#"},on:{click:t.addToShopping}},[e("i",{staticClass:"fas fa-shopping-cart fa-fw"}),t._v(" "+t._s(t.$t("Add_to_Shopping"))+" ")]):t._e(),t.disabled_options.plan?t._e():e("a",{staticClass:"dropdown-item",attrs:{href:"javascript:void(0);"},on:{click:t.createMealPlan}},[e("i",{staticClass:"fas fa-calendar fa-fw"}),t._v(" "+t._s(t.$t("Add_to_Plan"))+" ")]),e("a",{attrs:{href:"javascript:void(0);"}},[t.disabled_options.log?t._e():e("button",{staticClass:"dropdown-item",on:{click:function(e){return t.$bvModal.show(`id_modal_cook_log_${t.modal_id}`)}}},[e("i",{staticClass:"fas fa-clipboard-list fa-fw"}),t._v(" "+t._s(t.$t("Log_Cooking"))+" ")])]),e("a",{attrs:{href:"javascript:void(0);"}},[t.disabled_options.print?t._e():e("button",{staticClass:"dropdown-item",attrs:{onclick:"window.print()"}},[e("i",{staticClass:"fas fa-print fa-fw"}),t._v(" "+t._s(t.$t("Print"))+" ")])]),e("a",{attrs:{href:"javascript:void(0);"}},[t.disabled_options.copy?t._e():e("button",{staticClass:"dropdown-item",on:{click:t.copyToNew}},[e("i",{staticClass:"fas fa-copy fa-fw"}),t._v(" "+t._s(t.$t("copy_to_new"))+" ")])]),t.disabled_options.export?t._e():e("a",{staticClass:"dropdown-item",attrs:{href:t.resolveDjangoUrl("view_export")+"?r="+t.recipe.id,target:"_blank",rel:"noopener noreferrer"}},[e("i",{staticClass:"fas fa-file-export fa-fw"}),t._v(" "+t._s(t.$t("Export")))]),e("a",{attrs:{href:"javascript:void(0);"}},[t.disabled_options.pin?t._e():e("button",{staticClass:"dropdown-item",on:{click:function(e){return t.pinRecipe()}}},[e("i",{staticClass:"fas fa-thumbtack fa-fw"}),t._v(" "+t._s(t.isPinned?t.$t("Unpin"):t.$t("Pin"))+" ")])]),e("a",{attrs:{href:"javascript:void(0);"}},[t.recipe.internal&&!t.disabled_options.share?e("button",{staticClass:"dropdown-item",on:{click:function(e){return t.createShareLink()}}},[e("i",{staticClass:"fas fa-share-alt fa-fw"}),t._v(" "+t._s(t.$t("Share"))+" ")]):t._e()])])]),e("cook-log",{attrs:{recipe:t.recipe,modal_id:t.modal_id}}),e("add-recipe-to-book",{attrs:{recipe:t.recipe,modal_id:t.modal_id,entryEditing_inital_servings:t.servings_value}}),e("shopping-modal",{attrs:{recipe:t.recipe,servings:t.servings_value,modal_id:t.modal_id,mealplan:void 0}}),e("b-modal",{attrs:{id:`modal-share-link_${t.modal_id}`,title:t.$t("Share"),"hide-footer":""}},[e("div",{staticClass:"row"},[e("div",{staticClass:"col col-md-12"},[void 0!==t.recipe_share_link?e("label",[t._v(t._s(t.$t("Public share link")))]):t._e(),e("input",{directives:[{name:"model",rawName:"v-model",value:t.recipe_share_link,expression:"recipe_share_link"}],ref:"share_link_ref",staticClass:"form-control",domProps:{value:t.recipe_share_link},on:{input:function(e){e.target.composing||(t.recipe_share_link=e.target.value)}}}),e("b-button",{staticClass:"mt-2 mb-3 d-none d-md-inline",attrs:{variant:"secondary"},on:{click:function(e){return t.$bvModal.hide(`modal-share-link_${t.modal_id}`)}}},[t._v(t._s(t.$t("Close"))+" ")]),e("b-button",{staticClass:"mt-2 mb-3 ml-md-2",attrs:{variant:"primary"},on:{click:function(e){return t.copyShareLink()}}},[t._v(t._s(t.$t("Copy"))+" ")]),e("b-button",{staticClass:"mt-2 mb-3 ml-2 float-right",attrs:{variant:"success"},on:{click:function(e){return t.shareIntend()}}},[t._v(t._s(t.$t("Share"))+" "),e("i",{staticClass:"fa fa-share-alt"})])],1)])]),e("meal-plan-edit-modal",{attrs:{entry:t.entryEditing,modal_id:`modal-meal-plan_${t.modal_id}`,allow_delete:!1,modal_title:t.$t("Create_Meal_Plan_Entry")},on:{"save-entry":t.saveMealPlan}})],1)},o=[function(){var t=this,e=t._self._c;return e("a",{staticClass:"btn shadow-none pr-0 pl-0",attrs:{href:"javascript:void(0);",role:"button",id:"dropdownMenuLink","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}},[e("i",{staticClass:"fas fa-ellipsis-v fa-lg"})])}],s=(a(57658),a(87503)),n=a(22280),r=a(11072),d=a(92301),l=a(15782),c=a(6955),p=a(49665),_=a(5121),h=a(30381),m=a.n(h),u=a(70538);u["default"].prototype.moment=m();var f={name:"RecipeContextMenu",mixins:[p.ResolveUrlMixin],components:{AddRecipeToBook:r["default"],CookLog:s["default"],MealPlanEditModal:n["default"],ShoppingModal:d["default"]},data(){return{servings_value:0,isPinned:!1,recipe_share_link:void 0,modal_id:Math.round(1e5*Math.random()),options:{entryEditing:{date:null,id:-1,meal_type:null,note:"",note_markdown:"",recipe:null,servings:1,shared:[],title:"",title_placeholder:this.$t("Title")}},entryEditing:{},mealplan:void 0}},props:{recipe:Object,servings:{type:Number,default:-1},disabled_options:{type:Object,default:()=>({print:!0})}},mounted(){this.servings_value=-1===this.servings?this.recipe.servings:this.servings;let t=JSON.parse(localStorage.getItem("pinned_recipes"))||[];this.isPinned=t.some((t=>t.id==this.recipe.id))},watch:{recipe:{handler(){},deep:!0},servings:function(t){this.servings_value=parseInt(t)}},methods:{pinRecipe(){let t=JSON.parse(localStorage.getItem("pinned_recipes"))||[];this.isPinned?(t=t.filter((t=>t.id!==this.recipe.id)),(0,p.makeToast)(this.$t("Unpin"),this.$t("UnpinnedConfirmation",{recipe:this.recipe.name}),"info")):(t.push({id:this.recipe.id,name:this.recipe.name}),(0,p.makeToast)(this.$t("Pin"),this.$t("PinnedConfirmation",{recipe:this.recipe.name}),"info")),this.isPinned=!this.isPinned,localStorage.setItem("pinned_recipes",JSON.stringify(t))},saveMealPlan:function(t){t.from_date=m()(t.from_date).format("YYYY-MM-DD");let e=t.addshopping&&t.reviewshopping;t.addshopping=t.addshopping&&!t.reviewshopping;let a=new c.ApiApiFactory;a.createMealPlan(t).then((t=>{(0,l.I)().plans.push(t.data),this.$bvModal.hide(`modal-meal-plan_${this.modal_id}`),e&&(this.mealplan=t.data.id,this.servings_value=t.data.servings,this.addToShopping()),p.StandardToasts.makeStandardToast(this,p.StandardToasts.SUCCESS_CREATE)})).catch((t=>{p.StandardToasts.makeStandardToast(this,p.StandardToasts.FAIL_CREATE,t)}))},createMealPlan(t){this.entryEditing=this.options.entryEditing,this.entryEditing.recipe=this.recipe,this.entryEditing.servings=this.recipe.servings,this.entryEditing.from_date=m()(new Date).format("YYYY-MM-DD"),this.entryEditing.to_date=m()(new Date).format("YYYY-MM-DD"),this.$nextTick((function(){this.$bvModal.show(`modal-meal-plan_${this.modal_id}`)}))},createShareLink:function(){console.log("create"),_.Z.get((0,p.resolveDjangoUrl)("api_share_link",this.recipe.id)).then((t=>{console.log("success"),this.$bvModal.show(`modal-share-link_${this.modal_id}`),this.recipe_share_link=t.data.link})).catch((t=>{console.log("fail"),403===t.response.status&&(0,p.makeToast)(this.$t("Share"),this.$t("Sharing is not enabled for this space or your user account."),"danger")}))},copyShareLink:function(){let t=this.$refs.share_link_ref;t.select(),document.execCommand("copy")},shareIntend:function(){let t={title:this.recipe.name,text:`${this.$t("Check out this recipe: ")} ${this.recipe.name}`,url:this.recipe_share_link};navigator.share(t)},addToShopping(){this.$bvModal.show(`shopping_${this.modal_id}`)},copyToNew:function(){let t=window.prompt(this.$t("copy_to_new"),this.$t("recipe_name")),e=new c.ApiApiFactory;e.retrieveRecipe(this.recipe.id).then((a=>{let i={...a.data,id:void 0,name:t};i.steps=i.steps.map((t=>({...t,id:void 0,ingredients:t.ingredients.map((t=>({...t,id:void 0})))}))),i.properties=i.properties.map((t=>({...t,id:void 0}))),e.createRecipe(i).then((t=>{p.StandardToasts.makeStandardToast(this,p.StandardToasts.SUCCESS_CREATE),window.open(this.resolveDjangoUrl("view_recipe",t.data.id))})).catch((t=>{p.StandardToasts.makeStandardToast(this,p.StandardToasts.FAIL_CREATE,t)}))}))}}},g=f,v=a(1001),k=(0,v.Z)(g,i,o,!1,null,null,null),b=k.exports}}]);