"use strict";(self["webpackChunktandoor"]=self["webpackChunktandoor"]||[]).push([[2280],{81185:function(t,e,i){i.d(e,{R:function(){return p}});var a=i(96086),s=i(6955),n=i(70538),l=i(49665);const r=3e4,d="user_preference_store",o="TANDOOR_LOCAL_SETTINGS",c="TANDOOR_USER_SETTINGS",_=localStorage.getItem("USER_ID"),p=(0,a.Q_)(d,{state:()=>({data:null,updated_at:null,currently_updating:!1,user_settings_loaded_at:new Date(0),user_settings:{image:null,theme:"TANDOOR",nav_bg_color:"#ddbf86",nav_text_color:"DARK",nav_show_logo:!0,default_unit:"g",default_page:"SEARCH",use_fractions:!1,use_kj:!1,plan_share:[],nav_sticky:!0,ingredient_decimals:2,comments:!0,shopping_auto_sync:5,mealplan_autoadd_shopping:!1,food_inherit_default:[],default_delay:"4.0000",mealplan_autoinclude_related:!0,mealplan_autoexclude_onhand:!0,shopping_share:[],shopping_recent_days:7,csv_delim:",",csv_prefix:"",filter_to_supermarket:!1,shopping_add_onhand:!1,left_handed:!1,show_step_ingredients:!0,food_children_exist:!1,locally_updated_at:new Date(0)},device_settings_initialized:!1,device_settings_loaded_at:new Date(0),device_settings:{shopping_show_checked_entries:!1,shopping_show_delayed_entries:!1,shopping_show_selected_supermarket_only:!1,shopping_selected_grouping:"food.supermarket_category.name",shopping_selected_supermarket:null,shopping_item_info_created_by:!1,shopping_item_info_mealplan:!1,shopping_item_info_recipe:!0}}),getters:{},actions:{loadDeviceSettings(){let t=localStorage.getItem(o);if(null!==t){let e=JSON.parse(t);for(t in e)n["default"].set(this.device_settings,t,e[t])}this.device_settings_initialized=!0},updateDeviceSettings:function(){localStorage.setItem(o,JSON.stringify(this.device_settings))},loadUserSettings:function(t){let e=localStorage.getItem(c);if(null!==e){let t=JSON.parse(e);for(e in t)n["default"].set(this.user_settings,e,t[e]);console.log(`loaded local user settings age ${((new Date).getTime()-this.user_settings.locally_updated_at)/1e3} `)}if((new Date).getTime()-this.user_settings.locally_updated_at>r||!t){console.log("refreshing user settings from API");let t=new s.ApiApiFactory;t.retrieveUserPreference(localStorage.getItem("USER_ID")).then((t=>{for(e in t.data)e in this.user_settings||"user"===e?n["default"].set(this.user_settings,e,t.data[e]):console.error(`API returned UserPreference key "${e}" which has no default in UserPreferenceStore.user_settings.`);n["default"].set(this.user_settings,"locally_updated_at",(new Date).getTime()),localStorage.setItem(c,JSON.stringify(this.user_settings))})).catch((t=>{this.currently_updating=!1}))}},updateUserSettings:function(){let t=new s.ApiApiFactory;t.partialUpdateUserPreference(_,this.user_settings).then((t=>{this.user_settings=t.data,n["default"].set(this.user_settings,"locally_updated_at",(new Date).getTime()),localStorage.setItem(c,JSON.stringify(this.user_settings)),l.StandardToasts.makeStandardToast(this,l.StandardToasts.SUCCESS_UPDATE)})).catch((t=>{this.currently_updating=!1,l.StandardToasts.makeStandardToast(this,l.StandardToasts.FAIL_UPDATE,t)}))},getData:function(){return this.isStaleOrEmpty?this.refreshFromAPI():this.data},getStaleData:function(){return this.data},isStale(){return null===this.updated_at||new Date-this.updated_at>r},isEmpty(){return null===this.data},isStaleOrEmpty(){return this.isStale()||this.isEmpty()},updateIfStaleOrEmpty(){if(this.isStaleOrEmpty)return this.refreshFromAPI()},refreshFromAPI(){let t=new s.ApiApiFactory;if(!this.currently_updating)return this.currently_updating=!0,t.retrieveUserPreference(localStorage.getItem("USER_ID")).then((t=>(this.data=t.data,this.updated_at=new Date,this.currently_updating=!1,this.user_settings=t.data,this.user_settings_loaded_at=new Date,this.data))).catch((t=>{this.currently_updating=!1}))}}})},22280:function(t,e,i){i.r(e),i.d(e,{default:function(){return S}});var a=function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{attrs:{id:t.modal_id,size:"lg",title:t.modal_title,"hide-footer":"","aria-label":""},on:{show:t.showModal}},[null!==t.entryEditing?e("div",{staticClass:"row"},[e("div",{staticClass:"col col-md-12"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col col-md-12"},[e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("b-input-group",[e("b-form-input",{attrs:{id:"TitleInput",placeholder:t.entryEditing.title_placeholder},on:{change:function(e){t.missing_recipe=!1}},model:{value:t.entryEditing.title,callback:function(e){t.$set(t.entryEditing,"title",e)},expression:"entryEditing.title"}}),e("b-input-group-append",{staticClass:"d-none d-lg-block"},[e("b-button",{attrs:{variant:"primary"},on:{click:function(e){t.entryEditing.title=""}}},[e("i",{staticClass:"fa fa-eraser"})])],1)],1),t.missing_recipe?e("span",{staticClass:"text-danger"},[t._v(t._s(t.$t("Title_or_Recipe_Required")))]):t._e(),t.missing_recipe?t._e():e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("Title")))])],1),e("div",{staticClass:"col-12 col-lg-6"},[e("b-input-group",[e("b-form-input",{attrs:{type:"date"},model:{value:t.entryEditing.from_date,callback:function(e){t.$set(t.entryEditing,"from_date",e)},expression:"entryEditing.from_date"}}),e("b-input-group-append",[e("b-button",{attrs:{variant:"secondary"},on:{click:function(e){t.entryEditing.from_date=t.changeDate(t.entryEditing.from_date,-1)}}},[e("i",{staticClass:"fas fa-minus"})]),e("b-button",{attrs:{variant:"primary"},on:{click:function(e){t.entryEditing.from_date=t.changeDate(t.entryEditing.from_date,1)}}},[e("i",{staticClass:"fas fa-plus"})])],1)],1),e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("StartDate")))])],1),e("div",{staticClass:"col-12 col-lg-6"},[e("b-input-group",[e("b-form-input",{attrs:{type:"date"},model:{value:t.entryEditing.to_date,callback:function(e){t.$set(t.entryEditing,"to_date",e)},expression:"entryEditing.to_date"}}),e("b-input-group-append",[e("b-button",{attrs:{variant:"secondary"},on:{click:function(e){t.entryEditing.to_date=t.changeDate(t.entryEditing.to_date,-1)}}},[e("i",{staticClass:"fas fa-minus"})]),e("b-button",{attrs:{variant:"primary"},on:{click:function(e){t.entryEditing.to_date=t.changeDate(t.entryEditing.to_date,1)}}},[e("i",{staticClass:"fas fa-plus"})])],1)],1),e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("EndDate")))])],1)]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("b-form-group",[e("generic-multiselect",{staticStyle:{"flex-grow":"1","flex-shrink":"1","flex-basis":"0"},attrs:{initial_single_selection:t.entryEditing.recipe,label:"name",model:t.Models.RECIPE,placeholder:t.$t("Recipe"),limit:10,multiple:!1},on:{change:t.selectRecipe}}),e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("Recipe")))])],1)],1)]),e("div",{staticClass:"row"},[e("div",{staticClass:"col-12 col-lg-6 col-xl-6"},[e("b-form-group",{},[e("generic-multiselect",{staticStyle:{"flex-grow":"1","flex-shrink":"1","flex-basis":"0"},attrs:{required:"",label:"name",model:t.Models.MEAL_TYPE,placeholder:t.$t("Meal_Type"),limit:10,multiple:!1,initial_single_selection:t.entryEditing.meal_type,allow_create:!0,create_placeholder:t.$t("Create_New_Meal_Type")},on:{change:t.selectMealType}}),t.missing_meal_type?e("span",{staticClass:"text-danger"},[t._v(t._s(t.$t("Meal_Type_Required")))]):t._e(),t.missing_meal_type?t._e():e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("Meal_Type")))])],1),e("b-form-group",{staticClass:"mt-3",attrs:{"label-for":"NoteInput",description:t.$t("Note")}},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.entryEditing.note,expression:"entryEditing.note"}],staticClass:"form-control",attrs:{id:"NoteInput",placeholder:t.$t("Note")},domProps:{value:t.entryEditing.note},on:{input:function(e){e.target.composing||t.$set(t.entryEditing,"note",e.target.value)}}})]),e("b-input-group",[e("b-form-input",{attrs:{id:"ServingsInput",placeholder:t.$t("Servings")},model:{value:t.entryEditing.servings,callback:function(e){t.$set(t.entryEditing,"servings",e)},expression:"entryEditing.servings"}})],1),e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("Servings")))]),e("b-form-group",{staticClass:"mt-3"},[e("generic-multiselect",{staticStyle:{"flex-grow":"1","flex-shrink":"1","flex-basis":"0"},attrs:{required:"",parent_variable:"entryEditing.shared",label:"display_name",model:t.Models.USER_NAME,placeholder:t.$t("Share"),limit:10,multiple:!0,initial_selection:t.entryEditing.shared},on:{change:function(e){t.entryEditing.shared=e.val}}}),e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("Share")))])],1),t.autoMealPlan?t._e():e("b-input-group",[e("b-form-checkbox",{attrs:{id:"AddToShopping"},model:{value:t.mealplan_settings.addshopping,callback:function(e){t.$set(t.mealplan_settings,"addshopping",e)},expression:"mealplan_settings.addshopping"}}),e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("AddToShopping")))])],1),t.mealplan_settings.addshopping&&!t.autoMealPlan?e("b-input-group",[e("b-form-checkbox",{attrs:{id:"reviewShopping"},model:{value:t.mealplan_settings.reviewshopping,callback:function(e){t.$set(t.mealplan_settings,"reviewshopping",e)},expression:"mealplan_settings.reviewshopping"}}),e("small",{staticClass:"form-text text-muted",attrs:{tabindex:"-1"}},[t._v(t._s(t.$t("review_shopping")))])],1):t._e()],1),e("div",{staticClass:"col-lg-6 d-none d-lg-block d-xl-block"},[t.entryEditing.recipe?e("recipe-card",{attrs:{recipe:t.entryEditing.recipe,detailed:!1}}):t._e()],1)]),e("div",{staticClass:"row mt-3 mb-3"},[e("div",{staticClass:"col-12"},[t.allow_delete?e("b-button",{attrs:{variant:"danger"},on:{click:t.deleteEntry}},[t._v(t._s(t.$t("Delete"))+" ")]):t._e(),e("b-button",{staticClass:"float-right",attrs:{variant:"primary"},on:{click:t.editEntry}},[t._v(t._s(t.$t("Save"))+" ")])],1)])])])])]):t._e()]),null!==t.last_created_plan&&null!==t.last_created_plan.recipe?e("shopping-modal",{attrs:{recipe:t.last_created_plan.recipe,servings:t.last_created_plan.servings,modal_id:999999,mealplan:t.last_created_plan}}):t._e()],1)},s=[],n=i(70538),l=i(66123),r=i.n(l),d=i(12120),o=i(26678),c=i(49665),_=i(81185),p=i(15782),g=i(92301),u=i(30381),h=i.n(u);const{ApiApiFactory:m}=i(6955);n["default"].use(d.XG7),n["default"].use(r());let y="mealplan_settings";var f={name:"MealPlanEditModal",props:{entry:Object,create_date:String,modal_title:String,modal_id:{type:String,default:"id_meal_plan_edit_modal"},allow_delete:{type:Boolean,default:!0}},mixins:[c.ApiMixin,c.ToastMixin],components:{GenericMultiselect:o["default"],RecipeCard:()=>Promise.all([i.e(1956),i.e(3470)]).then(i.bind(i,13470)),ShoppingModal:g["default"]},data(){return{entryEditing:null,missing_recipe:!1,missing_meal_type:!1,default_plan_share:[],mealplan_settings:{addshopping:!1,reviewshopping:!1},last_created_plan:null}},watch:{entry:{handler(){this.entryEditing=Object.assign({},this.entry)},deep:!0},"entryEditing.from_date":{handler(t,e){if(void 0!==t&&void 0!==e&&t!==e&&t!==this.entryEditing.to_date){let i=Math.abs(h()(e).diff(h()(this.entryEditing.to_date),"days"));this.entryEditing.to_date=h()(t).add(i,"d").format("YYYY-MM-DD")}},deep:!0},mealplan_settings:{handler(t){this.$cookies.set(y,this.mealplan_settings)},deep:!0}},mounted:function(){(0,_.R)().updateIfStaleOrEmpty()},computed:{autoMealPlan:function(){return(0,_.R)().getStaleData()?.mealplan_autoadd_shopping}},methods:{showModal(){this.$cookies.isKey(y)&&(this.mealplan_settings=Object.assign({},this.mealplan_settings,this.$cookies.get(y))),null===this.entry?this.entryEditing=Object.assign({},(0,p.I)().empty_meal_plan,null):this.entryEditing=Object.assign({},this.entry,null),this.create_date&&(this.entryEditing.from_date=this.create_date,this.entryEditing.to_date=this.create_date),(0,_.R)().getData().then((t=>{-1===this.entryEditing.id&&(this.entryEditing.shared=t.plan_share)}))},editEntry(){null!=this.entryEditing.meal_type?null!=this.entryEditing.recipe||""!==this.entryEditing.title?(this.$bvModal.hide(this.modal_id),this.$set(this.entryEditing,"addshopping",this.mealplan_settings.addshopping&&!this.mealplan_settings.reviewshopping),"id"in this.entryEditing&&-1!==this.entryEditing.id?(0,p.I)().updateObject(this.entryEditing):(0,p.I)().createObject(this.entryEditing).then((t=>{this.last_created_plan=t.data,t.data.recipe&&this.mealplan_settings.addshopping&&!this.autoMealPlan&&this.mealplan_settings.reviewshopping&&this.$nextTick((function(){this.$bvModal.show("shopping_999999")}))}))):this.makeToast("Warning",this.$t("Title_or_Recipe_Required"),"warning"):this.makeToast("Warning",this.$t("Meal_Type_Required"),"warning")},deleteEntry(){this.$bvModal.hide(this.modal_id),(0,p.I)().deleteObject(this.entryEditing)},selectMealType(t){this.missing_meal_type=!1,null!=t.val?this.entryEditing.meal_type=t.val:this.entryEditing.meal_type=null},selectShared(t){null!=t.val?this.entryEditing.shared=t.val:this.entryEditing.meal_type=null},selectRecipe(t){this.missing_recipe=!1,null!=t.val?(this.entryEditing.recipe=t.val,this.entryEditing.title_placeholder=this.entryEditing.recipe.name,this.entryEditing.servings=this.entryEditing.recipe.servings):(this.entryEditing.recipe=null,this.entryEditing.title_placeholder="",this.entryEditing.servings=1)},changeDate(t,e){return h()(t).add(e,"d").format("YYYY-MM-DD")}}},v=f,E=i(1001),b=(0,E.Z)(v,a,s,!1,null,"838b285a",null),S=b.exports}}]);