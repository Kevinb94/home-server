"use strict";(self["webpackChunktandoor"]=self["webpackChunktandoor"]||[]).push([[3451],{61551:function(e,t,i){i.d(t,{s:function(){return s},x:function(){return n}});var s=function(){var e=this,t=e._self._c;return e.recipes!=={}?t("div",[t("div",{staticClass:"align-center",attrs:{id:"switcher"}},[t("i",{directives:[{name:"b-toggle",rawName:"v-b-toggle.related-recipes",modifiers:{"related-recipes":!0}}],staticClass:"btn btn-primary fas fa-receipt fa-xl fa-fw shadow-none btn-circle"})]),t("b-sidebar",{staticStyle:{"z-index":"10000"},attrs:{id:"related-recipes",backdrop:"",right:"",bottom:"","no-header":"",shadow:"sm"},on:{shown:function(t){return e.updatePinnedRecipes()}},scopedSlots:e._u([{key:"default",fn:function({hide:i}){return[t("div",{staticClass:"d-flex flex-column justify-content-end h-100 p-3 align-items-end"},[t("h5",[e._v(e._s(e.$t("Planned"))+" "),t("i",{staticClass:"fas fa-calendar fa-fw"})]),t("div",{staticClass:"text-right"},[e.planned_recipes.length>0?e._l(e.planned_recipes,(function(s){return t("div",{key:`plan${s.id}`},[t("div",{staticClass:"pb-1 pt-1"},[t("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){e.navRecipe(s),i()}}},[e._v(e._s(s.name))])])])})):[t("span",{staticClass:"text-muted"},[e._v(e._s(e.$t("nothing_planned_today")))])]],2),t("h5",[e._v(e._s(e.$t("Pinned"))+" "),t("i",{staticClass:"fas fa-thumbtack fa-fw"})]),e.pinned_recipes.length>0?[t("div",{staticClass:"text-right"},e._l(e.pinned_recipes,(function(s){return t("div",{key:`pin${s.id}`},[t("b-row",{staticClass:"pb-1 pt-1"},[t("b-col",{attrs:{cols:"2"}},[t("a",{staticClass:"text-muted",attrs:{href:"javascript:void(0)"},on:{click:function(t){return e.unPinRecipe(s)}}},[t("i",{staticClass:"fas fa-times"})])]),t("b-col",{attrs:{cols:"10"}},[t("a",{staticClass:"align-self-end",attrs:{href:"javascript:void(0);"},on:{click:function(t){e.navRecipe(s),i()}}},[e._v(e._s(s.name)+" ")])])],1)],1)})),0)]:[t("span",{staticClass:"text-muted"},[e._v(e._s(e.$t("no_pinned_recipes")))])],e.related_recipes.length>0?[t("h5",[e._v("Related "),t("i",{staticClass:"fas fa-link fa-fw"})]),t("div",{staticClass:"text-right"},e._l(e.related_recipes,(function(s){return t("div",{key:`related${s.id}`},[t("div",{staticClass:"pb-1 pt-1"},[t("a",{attrs:{href:"javascript:void(0);"},on:{click:function(t){e.navRecipe(s),i()}}},[e._v(e._s(s.name))])])])})),0)]:e._e()],2)]}},{key:"footer",fn:function({hide:i}){return[t("div",{staticClass:"d-flex bg-dark text-light align-items-center px-3 py-2"},[t("strong",{staticClass:"mr-auto"},[e._v(e._s(e.$t("Quick actions")))]),t("b-button",{attrs:{size:"sm"},on:{click:i}},[e._v(e._s(e.$t("Close")))])],1)]}}],null,!1,1200845374)})],1):e._e()},n=[]},98682:function(e,t,i){i.r(t);var s=i(61551),n=i(70179),a=(i(58536),i(1001)),r=(0,a.Z)(n.Z,s.s,s.x,!1,null,null,null);t["default"]=r.exports},58536:function(e,t,i){i(68185)},70179:function(e,t,i){var s=i(6361);t.Z=s.Z},68185:function(){},6361:function(e,t,i){i(57658);var s=i(49665);const{ApiApiFactory:n}=i(6955);t.Z={name:"RecipeSwitcher",mixins:[s.ResolveUrlMixin],props:{recipe:{type:Number,default:void 0}},data(){return{related_recipes:[],planned_recipes:[],pinned_recipes:[],recipes:{}}},computed:{is_recipe_view:function(){return this.$root._vnode.tag.includes("RecipeView")}},mounted(){let e=[];e.push(this.loadRelatedRecipes()),this.loadPinnedRecipes(),e.push(this.loadMealPlans()),Promise.all(e).then((()=>{this.loadRecipeData()}))},methods:{navRecipe:function(e){this.is_recipe_view?this.$emit("switch",this.recipes[e.id]):window.location.href=this.resolveDjangoUrl("view_recipe",e.id)},updatePinnedRecipes:function(){this.loadPinnedRecipes(),this.loadRecipeData()},loadRecipeData:function(){let e=new n,t=[...this.related_recipes,...this.planned_recipes,...this.pinned_recipes],i=[];t.forEach((e=>{let t=e.id;i.includes(t)||i.push(t)})),i.forEach((t=>{e.retrieveRecipe(t).then((e=>{this.recipes[t]=e.data}))}))},loadRelatedRecipes:function(){let e=new n;if(this.$parent.recipe)return this.related_recipes=[this.$parent.recipe],e.relatedRecipe(this.$parent.recipe.id,{query:{levels:2,format:"json"}}).then((e=>{this.related_recipes=this.related_recipes.concat(e.data)}))},loadPinnedRecipes:function(){let e=JSON.parse(localStorage.getItem("pinned_recipes"))||[];this.pinned_recipes=e},loadMealPlans:function(){let e=new n;var t=6e4*(new Date).getTimezoneOffset();let i=new Date(Date.now()-t).toISOString().split("T")[0];return e.listMealPlans(i,i).then((t=>{let i=[];return t.data.forEach((t=>{this.planned_recipes.push({...t?.recipe,servings:t?.servings});const s=(t?.servings??t?.recipe?.servings??1)/(t?.recipe?.servings??1);i.push(e.relatedRecipe(t?.recipe?.id,{query:{levels:2}}).then((e=>{e.data=e.data.map((e=>({...e,factor:s}))),this.planned_recipes=[...this.planned_recipes,...e.data]})))})),Promise.all(i)}))},unPinRecipe:function(e){let t=JSON.parse(localStorage.getItem("pinned_recipes"))||[];t=t.filter((t=>t.id!==e.id)),console.log("pinned left",t),this.pinned_recipes=t,localStorage.setItem("pinned_recipes",JSON.stringify(t))}}}}}]);