"use strict";(self["webpackChunktandoor"]=self["webpackChunktandoor"]||[]).push([[5559],{28977:function(t,e,o){o.r(e),o.d(e,{default:function(){return f}});var n=function(){var t=this,e=t._self._c;return e("div",[e("b-modal",{attrs:{id:t.id,size:"xl","body-class":"pr-3 pl-3"},on:{hidden:t.cancelAction},scopedSlots:t._u([{key:"modal-title",fn:function(){return[t.food?e("div",{staticClass:"row"},[e("div",{staticClass:"col-12"},[e("h2",[t._v(t._s(t.food.name)+" "),t.food.plural_name?e("small",{staticClass:"text-muted"},[t._v(t._s(t.food.plural_name))]):t._e()])])]):t._e()]},proxy:!0},{key:"modal-footer",fn:function(){return[e("b-button",{attrs:{variant:"primary"},on:{click:t.updateFood}},[t._v(t._s(t.$t("Save")))])]},proxy:!0}])},[e("div",[t.food?e("b-tabs",{attrs:{"content-class":"mt-3"}},[e("b-tab",{attrs:{title:"General",active:""}},[e("b-form",[e("b-form-group",{attrs:{label:t.$t("Name"),description:""}},[e("b-form-input",{model:{value:t.food.name,callback:function(e){t.$set(t.food,"name",e)},expression:"food.name"}})],1),e("b-form-group",{attrs:{label:t.$t("Plural"),description:""}},[e("b-form-input",{model:{value:t.food.plural_name,callback:function(e){t.$set(t.food,"plural_name",e)},expression:"food.plural_name"}})],1),e("b-form-group",{attrs:{label:t.$t("Description"),description:""}},[e("b-form-textarea",{attrs:{rows:"2"},model:{value:t.food.description,callback:function(e){t.$set(t.food,"description",e)},expression:"food.description"}})],1),e("h5",[e("i",{staticClass:"fas fa-database"}),t._v(" "+t._s(t.$t("Properties")))]),e("b-form-group",{attrs:{label:t.$t("Properties_Food_Amount"),description:""}},[e("b-form-input",{model:{value:t.food.properties_food_amount,callback:function(e){t.$set(t.food,"properties_food_amount",e)},expression:"food.properties_food_amount"}})],1),e("b-form-group",{attrs:{label:t.$t("Properties_Food_Unit"),description:""}},[e("generic-multiselect",{attrs:{model:t.Models.UNIT,initial_single_selection:t.food.properties_food_unit,label:"name",multiple:!1,placeholder:t.$t("Unit")},on:{change:function(e){t.food.properties_food_unit=e.val}}})],1),e("table",{staticClass:"table table-bordered"},[e("thead",[e("tr",[e("th",[t._v(" "+t._s(t.$t("Property Amount")))]),t._v(" "),e("th",[t._v(" "+t._s(t.$t("Property Type")))]),t._v(" "),e("th"),e("th")])]),t._l(t.food.properties,(function(o){return e("tr",{key:o.id},[e("td",[e("input",{directives:[{name:"model",rawName:"v-model",value:o.property_amount,expression:"fp.property_amount"}],attrs:{type:"number"},domProps:{value:o.property_amount},on:{input:function(e){e.target.composing||t.$set(o,"property_amount",e.target.value)}}}),t._v(" "),o.property_type?e("span",[t._v(t._s(o.property_type.unit))]):t._e()]),e("td",[e("generic-multiselect",{attrs:{initial_single_selection:o.property_type,label:"name",model:t.Models.PROPERTY_TYPE,multiple:!1},on:{change:function(t){o.property_type=t.val}}})],1),e("td",[t._v(" / "),e("span",[t._v(t._s(t.food.properties_food_amount)+" "),null!==t.food.properties_food_unit?e("span",[t._v(t._s(t.food.properties_food_unit.name))]):t._e()])]),e("td",[e("a",{staticClass:"btn btn-danger btn-small",on:{click:function(e){return t.deleteProperty(o)}}},[e("i",{staticClass:"fas fa-trash-alt"})])])])}))],2),e("div",{staticClass:"text-center"},[e("b-button-group",[e("b-btn",{staticClass:"btn btn-success shadow-none",on:{click:function(e){return t.addProperty()}}},[e("i",{staticClass:"fa fa-plus"})]),e("b-btn",{staticClass:"btn btn-secondary shadow-none",on:{click:function(e){return t.addAllProperties()}}},[e("i",{staticClass:"fa fa-plus"},[e("i",{staticClass:"ml-1 fas fa-list"})])])],1)],1),e("b-form-group",{attrs:{label:t.$t("Shopping_Category"),description:t.$t("shopping_category_help")}},[e("generic-multiselect",{attrs:{model:t.Models.SHOPPING_CATEGORY,initial_single_selection:t.food.supermarket_category,label:"name",multiple:!1,allow_create:!0,placeholder:t.$t("Shopping_Category")},on:{change:function(e){t.food.supermarket_category=e.val}}})],1)],1)],1),void 0!==this.food.id?e("b-tab",{attrs:{title:"Conversions"},on:{click:t.loadUnitConversions}},[t._l(t.unit_conversions,(function(o){return e("b-row",{key:o},[e("b-col",[o.id?e("span",[e("b-btn",{staticClass:"btn btn-sm",attrs:{variant:"danger"},on:{click:function(e){return t.deleteUnitConversion(o)}}},[e("i",{staticClass:"fas fa-trash-alt"})]),t._v(" "+t._s(o.base_amount)+" "+t._s(o.base_unit.name)+" = "+t._s(o.converted_amount)+" "+t._s(o.converted_unit.name)+" ")],1):t._e(),e("b-form",{staticClass:"mt-1"},[e("b-input-group",[e("b-input",{on:{change:function(t){o.changed=!0}},model:{value:o.base_amount,callback:function(e){t.$set(o,"base_amount",e)},expression:"uc.base_amount"}}),e("b-input-group-append",[e("generic-multiselect",{attrs:{initial_single_selection:o.base_unit,label:"name",model:t.Models.UNIT,multiple:!1},on:{change:function(t){o.base_unit=t.val,o.changed=!0}}})],1)],1),e("b-input-group",[e("b-input",{on:{change:function(t){o.changed=!0}},model:{value:o.converted_amount,callback:function(e){t.$set(o,"converted_amount",e)},expression:"uc.converted_amount"}}),e("b-input-group-append",[e("generic-multiselect",{attrs:{initial_single_selection:o.converted_unit,label:"name",model:t.Models.UNIT,multiple:!1},on:{change:function(t){o.converted_unit=t.val,o.changed=!0}}})],1)],1)],1)],1),e("hr",{staticStyle:{height:"1px"}})],1)})),e("b-row",[e("b-col",{staticClass:"text-center"},[e("b-btn",{attrs:{variant:"success"},on:{click:t.addUnitConversion}},[e("i",{staticClass:"fa fa-plus"})])],1)],1)],2):t._e(),e("b-tab",{attrs:{title:"More"}},[e("b-form",[e("b-form-group",{attrs:{label:t.$t("Recipe"),description:t.$t("food_recipe_help")}},[e("generic-multiselect",{attrs:{model:t.Models.RECIPE,initial_single_selection:t.food.recipe,label:"name",multiple:!1,placeholder:t.$t("Recipe")},on:{change:function(e){t.food.recipe=e.val}}})],1),e("b-form-group",{attrs:{label:t.$t("URL"),description:""}},[e("b-form-input",{model:{value:t.food.url,callback:function(e){t.$set(t.food,"url",e)},expression:"food.url"}})],1),e("b-form-group",{attrs:{description:t.$t("OnHand_help")}},[e("b-form-checkbox",{model:{value:t.food.food_onhand,callback:function(e){t.$set(t.food,"food_onhand",e)},expression:"food.food_onhand"}},[t._v(t._s(t.$t("OnHand")))])],1),e("b-form-group",{attrs:{description:t.$t("ignore_shopping_help")}},[e("b-form-checkbox",{model:{value:t.food.ignore_shopping,callback:function(e){t.$set(t.food,"ignore_shopping",e)},expression:"food.ignore_shopping"}},[t._v(t._s(t.$t("Ignore_Shopping"))+" ")])],1),e("hr"),e("b-form-group",{attrs:{label:t.$t("Substitutes"),description:t.$t("substitute_help")}},[e("generic-multiselect",{attrs:{model:t.Models.FOOD,initial_selection:t.food.substitute,label:"name",multiple:!0,placeholder:t.$t("Substitutes")},on:{change:function(e){t.food.substitute=e.val}}})],1),e("b-form-group",{attrs:{description:t.$t("substitute_siblings_help")}},[e("b-form-checkbox",{model:{value:t.food.substitute_siblings,callback:function(e){t.$set(t.food,"substitute_siblings",e)},expression:"food.substitute_siblings"}},[t._v(t._s(t.$t("substitute_siblings"))+" ")])],1),e("b-form-group",{attrs:{description:t.$t("substitute_children_help")}},[e("b-form-checkbox",{model:{value:t.food.substitute_children,callback:function(e){t.$set(t.food,"substitute_children",e)},expression:"food.substitute_children"}},[t._v(t._s(t.$t("substitute_children"))+" ")])],1),e("b-form-group",{attrs:{label:t.$t("InheritFields"),description:t.$t("InheritFields_help")}},[e("generic-multiselect",{attrs:{model:t.Models.FOOD_INHERIT_FIELDS,initial_selection:t.food.inherit_fields,label:"name",multiple:!0,placeholder:t.$t("InheritFields")},on:{change:function(e){t.food.inherit_fields=e.val}}})],1),e("b-form-group",{attrs:{label:t.$t("ChildInheritFields"),description:t.$t("ChildInheritFields_help")}},[e("generic-multiselect",{attrs:{model:t.Models.FOOD_INHERIT_FIELDS,initial_sselection:t.food.child_inherit_fields,label:"name",multiple:!0,placeholder:t.$t("ChildInheritFields")},on:{change:function(e){t.food.child_inherit_fields=e.val}}})],1),e("b-form-group",{attrs:{description:t.$t("reset_children_help")}},[e("b-form-checkbox",{model:{value:t.food.reset_inherit,callback:function(e){t.$set(t.food,"reset_inherit",e)},expression:"food.reset_inherit"}},[t._v(t._s(t.$t("reset_children"))+" ")])],1),e("b-form-group",{attrs:{label:t.$t("Open_Data_Slug"),description:t.$t("open_data_help_text")}},[e("b-form-input",{attrs:{disabled:""},model:{value:t.food.open_data_slug,callback:function(e){t.$set(t.food,"open_data_slug",e)},expression:"food.open_data_slug"}})],1)],1)],1)],1):t._e()],1)])],1)},i=[],s=(o(57658),o(70538)),a=o(12120),r=(o(57024),o(6955)),l=o(26678),d=o(49665);s["default"].use(a.XG7);var c={name:"FoodEditor",mixins:[d.ApiMixin],components:{GenericMultiselect:l["default"]},props:{id:{type:String,default:"id_food_edit_modal_modal"},show:{required:!0,type:Boolean,default:!1},item1:{type:Object,default:void 0}},watch:{show:function(){this.show?this.$bvModal.show(this.id):this.$bvModal.hide(this.id)}},data(){return{food:void 0,unit_conversions:[]}},mounted(){this.$bvModal.show(this.id),this.$i18n.locale=window.CUSTOM_LOCALE;let t,e=new r.ApiApiFactory;void 0!==this.item1.id?t=e.retrieveFood(this.item1.id).then((t=>{this.food=t.data,null===this.food.properties_food_unit&&(this.food.properties_food_unit={name:"g"})})).catch((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_FETCH,t)})):this.food={name:"",plural_name:"",description:"",shopping:!1,recipe:null,url:"",properties:[],properties_food_amount:100,properties_food_unit:{name:"g"},food_onhand:!1,supermarket_category:null,parent:null,numchild:0,inherit_fields:[],ignore_shopping:!1,substitute:[],substitute_siblings:!1,substitute_children:!1,substitute_onhand:!1,child_inherit_fields:[]}},methods:{updateFood:function(){let t=new r.ApiApiFactory;void 0!==this.food.id?t.updateFood(this.food.id,this.food).then((t=>{this.food=t.data,d.StandardToasts.makeStandardToast(this,d.StandardToasts.SUCCESS_UPDATE)})).catch((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_UPDATE,t)})):t.createFood(this.food).then((t=>{this.food=t.data,d.StandardToasts.makeStandardToast(this,d.StandardToasts.SUCCESS_CREATE)})).catch((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_UPDATE,t)})),this.unit_conversions.forEach((e=>{!0===e.changed&&(void 0===e.id?t.createUnitConversion(e).then((t=>{e=t.data})).catch((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_CREATE,t,!0)})):t.updateUnitConversion(e.id,e).then((t=>{e=t.data})).catch((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_UPDATE,t,!0)})))}))},addProperty:function(){this.food.properties.push({property_type:null,property_amount:0})},addAllProperties:function(){let t=new r.ApiApiFactory;t.listPropertyTypes().then((t=>{t.data.forEach((t=>{this.food.properties.push({property_type:t,property_amount:0})}))})).catch((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_FETCH,t)}))},deleteProperty:function(t){this.food.properties=this.food.properties.filter((e=>e!==t))},cancelAction:function(){this.$emit("hidden","")},loadUnitConversions:function(){let t=new r.ApiApiFactory;t.listUnitConversions(this.food.id).then((t=>{this.unit_conversions=t.data}))},addUnitConversion:function(){this.unit_conversions.push({food:this.food,base_amount:1,base_unit:null,converted_amount:0,converted_unit:null})},deleteUnitConversion:function(t){this.unit_conversions=this.unit_conversions.filter((e=>e!==t));let e=new r.ApiApiFactory;e.destroyUnitConversion(t.id).then((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.SUCCESS_DELETE)})).catch((t=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_DELETE,t)}))}}},u=c,p=o(1001),_=(0,p.Z)(u,n,i,!1,null,null,null),f=_.exports}}]);