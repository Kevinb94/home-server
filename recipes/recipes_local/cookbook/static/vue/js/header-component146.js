"use strict";(self["webpackChunktandoor"]=self["webpackChunktandoor"]||[]).push([[8796,109],{15782:function(e,t,s){s.d(t,{I:function(){return d}});s(57658);var i=s(6955),a=s(49665),n=s(96086),r=s(70538);const l="meal_plan_store",o="MEAL_PLAN_CLIENT_SETTINGS",d=(0,n.Q_)(l,{state:()=>({plans:{},currently_updating:null,settings:null}),getters:{plan_list:function(){let e=[];for(let t in this.plans)e.push(this.plans[t]);return e},empty_meal_plan:function(){return{from_date:null,to_date:null,id:-1,meal_type:null,note:"",note_markdown:"",recipe:null,servings:1,shared:[],title:"",title_placeholder:"Title"}},client_settings:function(){return null===this.settings&&(this.settings=this.loadClientSettings()),this.settings}},actions:{refreshFromAPI(e,t){if(null==this.currently_updating||this.currently_updating[0]!==e||this.currently_updating[1]!==t){this.currently_updating=[e,t];let s=new i.ApiApiFactory;s.listMealPlans(e,t).then((e=>{e.data.forEach((e=>{r["default"].set(this.plans,e.id,e)})),this.currently_updating=null}))}},createObject(e){let t=new i.ApiApiFactory;return t.createMealPlan(e).then((e=>(r["default"].set(this.plans,e.data.id,e.data),e))).catch((e=>{a.StandardToasts.makeStandardToast(this,a.StandardToasts.FAIL_CREATE,e)}))},updateObject(e){let t=new i.ApiApiFactory;return t.updateMealPlan(e.id,e).then((t=>{r["default"].set(this.plans,e.id,e)})).catch((e=>{a.StandardToasts.makeStandardToast(this,a.StandardToasts.FAIL_UPDATE,e)}))},deleteObject(e){let t=new i.ApiApiFactory;return t.destroyMealPlan(e.id).then((t=>{r["default"].delete(this.plans,e.id)})).catch((e=>{a.StandardToasts.makeStandardToast(this,a.StandardToasts.FAIL_DELETE,e)}))},updateClientSettings(e){this.settings=e,localStorage.setItem(o,JSON.stringify(this.settings))},loadClientSettings(){let e=localStorage.getItem(o);return null===e?{displayPeriodUom:"week",displayPeriodCount:3,startingDayOfWeek:1,displayWeekNumbers:!0}:JSON.parse(e)}}})},76488:function(e,t,s){s.d(t,{W:function(){return p}});s(57658);var i=s(81185),a=s(6955),n=s(49665),r=s(96486),l=s.n(r),o=s(30381),d=s.n(o),c=s(96086),u=s(70538);const _="shopping_list_store",p=(0,c.Q_)(_,{state:()=>({entries:{},supermarket_categories:[],supermarkets:[],total_unchecked:0,total_checked:0,total_unchecked_food:0,total_checked_food:0,currently_updating:!1,last_autosync:null,autosync_has_focus:!0,autosync_timeout_id:null,undo_stack:[],queue_timeout_id:void 0,item_check_sync_queue:{},GROUP_CATEGORY:"food.supermarket_category.name",GROUP_CREATED_BY:"created_by.display_name",GROUP_RECIPE:"recipe_mealplan.recipe_name",UNDEFINED_CATEGORY:"shopping_undefined_category"}),getters:{get_entries_by_group:function(){let e={},t=[];for(let l in this.entries)e=this.updateEntryInStructure(e,this.entries[l],(0,i.R)().device_settings.shopping_selected_grouping);let s=0,a=0,n=0,r=0;for(let i in e){let t=0,l=0,o=0,d=0,c=0;for(let s in e[i]["foods"]){let a=!0;for(let n in e[i]["foods"][s]["entries"])e[i]["foods"][s]["entries"][n].checked?l++:(a=!1,t++,this.is_delayed(e[i]["foods"][s]["entries"][n])&&c++);a?d++:o++}u["default"].set(e[i],"count_unchecked",t),u["default"].set(e[i],"count_checked",l),u["default"].set(e[i],"count_unchecked_food",o),u["default"].set(e[i],"count_checked_food",d),u["default"].set(e[i],"count_delayed_unchecked",c),s+=t,a+=l,n+=o,r+=d}if(this.total_unchecked=s,this.total_checked=a,this.total_unchecked_food=n,this.total_checked_food=r,this.UNDEFINED_CATEGORY in e&&(t.push(e[this.UNDEFINED_CATEGORY]),u["default"].delete(e,this.UNDEFINED_CATEGORY)),(0,i.R)().device_settings.shopping_selected_grouping===this.GROUP_CATEGORY&&null!==(0,i.R)().device_settings.shopping_selected_supermarket){for(let s of(0,i.R)().device_settings.shopping_selected_supermarket.category_to_supermarket)s.category.name in e&&(t.push(e[s.category.name]),u["default"].delete(e,s.category.name));if(!(0,i.R)().device_settings.shopping_show_selected_supermarket_only)for(let s in e)t.push(e[s])}else for(let i in e)t.push(e[i]);return t},get_flat_entries:function(){let e=[];for(let t in this.get_entries_by_group)for(let s in this.get_entries_by_group[t]["foods"])for(let i in this.get_entries_by_group[t]["foods"][s]["entries"])e.push({amount:this.get_entries_by_group[t]["foods"][s]["entries"][i].amount,unit:this.get_entries_by_group[t]["foods"][s]["entries"][i].unit?.name??"",food:this.get_entries_by_group[t]["foods"][s]["entries"][i].food?.name??""});return e},grouping_options:function(){return[{id:this.GROUP_CATEGORY,translatable_label:"Category"},{id:this.GROUP_CREATED_BY,translatable_label:"created_by"},{id:this.GROUP_RECIPE,translatable_label:"Recipe"}]},has_failed_items:function(){for(let e in this.item_check_sync_queue)if("syncing_failed_before"===this.item_check_sync_queue[e]["status"]||"waiting_failed_before"===this.item_check_sync_queue[e]["status"])return!0;return!1}},actions:{refreshFromAPI(){if(!this.currently_updating){this.currently_updating=!0,this.last_autosync=(new Date).getTime();let e=new a.ApiApiFactory;e.listShoppingListEntrys().then((e=>{this.entries={},e.data.forEach((e=>{u["default"].set(this.entries,e.id,e)})),this.currently_updating=!1})).catch((e=>{this.currently_updating=!1,n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_FETCH,e)})),e.listSupermarketCategorys().then((e=>{this.supermarket_categories=e.data})).catch((e=>{n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_FETCH,e)})),e.listSupermarkets().then((e=>{this.supermarkets=e.data})).catch((e=>{n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_FETCH,e)}))}},autosync(){if(!this.currently_updating&&this.autosync_has_focus){console.log("running autosync"),this.currently_updating=!0;let e=this.last_autosync;this.last_autosync=(new Date).getTime();let t=new a.ApiApiFactory;t.listShoppingListEntrys(void 0,void 0,void 0,{query:{last_autosync:e}}).then((e=>{e.data.forEach((e=>{(!Object.keys(this.entries).includes(e.id.toString())||Date.parse(this.entries[e.id].updated_at)<Date.parse(e.updated_at))&&(console.log("auto sync updating entry ",e),u["default"].set(this.entries,e.id,e))})),this.currently_updating=!1})).catch((e=>{console.warn("auto sync failed"),this.currently_updating=!1}))}},createObject(e){let t=new a.ApiApiFactory;return t.createShoppingListEntry(e).then((e=>{u["default"].set(this.entries,e.data.id,e.data),this.registerChange("CREATED",{[e.data.id]:e.data})})).catch((e=>{n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_UPDATE,e)}))},updateObject(e){let t=new a.ApiApiFactory;return u["default"].set(e,"updated_at",d()().format()),t.updateShoppingListEntry(e.id,e).then((e=>{u["default"].set(this.entries,e.data.id,e.data)})).catch((e=>{n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_UPDATE,e)}))},deleteObject(e){let t=new a.ApiApiFactory;return t.destroyShoppingListEntry(e.id).then((t=>{u["default"].delete(this.entries,e.id)})).catch((e=>{n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_DELETE,e)}))},getAssociatedRecipes:function(){let e={};for(let t in this.entries){let s=this.entries[t];null!==s.recipe_mealplan&&u["default"].set(e,s.recipe_mealplan.recipe,{shopping_list_recipe_id:s.list_recipe,recipe_id:s.recipe_mealplan.recipe,recipe_name:s.recipe_mealplan.recipe_name,servings:s.recipe_mealplan.servings,mealplan_from_date:s.recipe_mealplan.mealplan_from_date,mealplan_type:s.recipe_mealplan.mealplan_type})}return e},updateEntryInStructure(e,t,s){let i=l().get(t,s,this.UNDEFINED_CATEGORY);return void 0!==i&&null!==i||(i=this.UNDEFINED_CATEGORY),i in e||u["default"].set(e,i,{name:i,foods:{}}),t.food.id in e[i]["foods"]||u["default"].set(e[i]["foods"],t.food.id,{id:t.food.id,name:t.food.name,entries:{}}),u["default"].set(e[i]["foods"][t.food.id]["entries"],t.id,t),e},setEntriesCheckedState(e,t,s){s&&this.registerChange(t?"CHECKED":"UNCHECKED",e);let i=[];for(let a in e)u["default"].set(this.entries[a],"checked",t),u["default"].set(this.entries[a],"updated_at",d()().format()),i.push(a);this.item_check_sync_queue,u["default"].set(this.item_check_sync_queue,Math.random(),{ids:i,checked:t,status:"waiting"}),this.runSyncQueue(5)},_replaySyncQueue(){if(navigator.onLine||document.location.href.includes("localhost")){let e=new a.ApiApiFactory,t=[];for(let s in this.item_check_sync_queue){let i=this.item_check_sync_queue[s];u["default"].set(i,"status","waiting"===i["status"]?"syncing":"syncing_failed_before"),u["default"].set(this.item_check_sync_queue,s,i);let a=e.bulkShoppingListEntry(i,{timeout:15e3}).then((e=>{u["default"].delete(this.item_check_sync_queue,s)})).catch((e=>{"ERR_NETWORK"===e.code||"ECONNABORTED"===e.code?(u["default"].set(i,"status","waiting_failed_before"),u["default"].set(this.item_check_sync_queue,s,i)):(u["default"].delete(this.item_check_sync_queue,s),console.error("Failed API call for entry ",i),n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_UPDATE,e))}));t.push(a)}Promise.allSettled(t).finally((e=>{this.runSyncQueue(500)}))}else this.runSyncQueue(5e3)},runSyncQueue(e){clearTimeout(this.queue_timeout_id),this.queue_timeout_id=setTimeout((()=>{this._replaySyncQueue()}),e)},delayEntries(e,t,s){let a=(0,i.R)().user_settings.default_delay,n=new Date(Date.now()+36e5*a);s&&this.registerChange(t?"DELAY":"UNDELAY",e);for(let i in e)this.entries[i].delay_until=t?n:null,this.updateObject(this.entries[i])},deleteEntries(e){for(let t in e)this.deleteObject(this.entries[t])},deleteShoppingListRecipe(e){let t=new a.ApiApiFactory;for(let s in this.entries)this.entries[s].list_recipe===e&&u["default"].delete(this.entries,s);t.destroyShoppingListRecipe(e).then((e=>{})).catch((e=>{n.StandardToasts.makeStandardToast(this,n.StandardToasts.FAIL_DELETE,e)}))},registerChange(e,t){if(!["CREATED","CHECKED","UNCHECKED","DELAY","UNDELAY"].includes(e))throw Error("Tried to register unknown change type");this.undo_stack.push({type:e,entries:t})},undoChange(){let e=this.undo_stack.pop();if(void 0!==e){let t=e["type"],s=e["entries"];if("CHECKED"===t||"UNCHECKED"===t)this.setEntriesCheckedState(s,"UNCHECKED"===t,!1);else if("DELAY"===t||"UNDELAY"===t)this.delayEntries(s,"UNDELAY"===t,!1);else if("CREATED"===t)for(let e in s){let t=s[e];this.deleteObject(t)}}},is_delayed:function(e){let t=!1;if(null!=e.delay_until){const s=new Date(e.delay_until);t=s.getTime()>Date.now()}return t}}})},81185:function(e,t,s){s.d(t,{R:function(){return _}});var i=s(96086),a=s(6955),n=s(70538),r=s(49665);const l=3e4,o="user_preference_store",d="TANDOOR_LOCAL_SETTINGS",c="TANDOOR_USER_SETTINGS",u=localStorage.getItem("USER_ID"),_=(0,i.Q_)(o,{state:()=>({data:null,updated_at:null,currently_updating:!1,user_settings_loaded_at:new Date(0),user_settings:{image:null,theme:"TANDOOR",nav_bg_color:"#ddbf86",nav_text_color:"DARK",nav_show_logo:!0,default_unit:"g",default_page:"SEARCH",use_fractions:!1,use_kj:!1,plan_share:[],nav_sticky:!0,ingredient_decimals:2,comments:!0,shopping_auto_sync:5,mealplan_autoadd_shopping:!1,food_inherit_default:[],default_delay:"4.0000",mealplan_autoinclude_related:!0,mealplan_autoexclude_onhand:!0,shopping_share:[],shopping_recent_days:7,csv_delim:",",csv_prefix:"",filter_to_supermarket:!1,shopping_add_onhand:!1,left_handed:!1,show_step_ingredients:!0,food_children_exist:!1,locally_updated_at:new Date(0)},device_settings_initialized:!1,device_settings_loaded_at:new Date(0),device_settings:{shopping_show_checked_entries:!1,shopping_show_delayed_entries:!1,shopping_show_selected_supermarket_only:!1,shopping_selected_grouping:"food.supermarket_category.name",shopping_selected_supermarket:null,shopping_item_info_created_by:!1,shopping_item_info_mealplan:!1,shopping_item_info_recipe:!0}}),getters:{},actions:{loadDeviceSettings(){let e=localStorage.getItem(d);if(null!==e){let t=JSON.parse(e);for(e in t)n["default"].set(this.device_settings,e,t[e])}this.device_settings_initialized=!0},updateDeviceSettings:function(){localStorage.setItem(d,JSON.stringify(this.device_settings))},loadUserSettings:function(e){let t=localStorage.getItem(c);if(null!==t){let e=JSON.parse(t);for(t in e)n["default"].set(this.user_settings,t,e[t]);console.log(`loaded local user settings age ${((new Date).getTime()-this.user_settings.locally_updated_at)/1e3} `)}if((new Date).getTime()-this.user_settings.locally_updated_at>l||!e){console.log("refreshing user settings from API");let e=new a.ApiApiFactory;e.retrieveUserPreference(localStorage.getItem("USER_ID")).then((e=>{for(t in e.data)t in this.user_settings||"user"===t?n["default"].set(this.user_settings,t,e.data[t]):console.error(`API returned UserPreference key "${t}" which has no default in UserPreferenceStore.user_settings.`);n["default"].set(this.user_settings,"locally_updated_at",(new Date).getTime()),localStorage.setItem(c,JSON.stringify(this.user_settings))})).catch((e=>{this.currently_updating=!1}))}},updateUserSettings:function(){let e=new a.ApiApiFactory;e.partialUpdateUserPreference(u,this.user_settings).then((e=>{this.user_settings=e.data,n["default"].set(this.user_settings,"locally_updated_at",(new Date).getTime()),localStorage.setItem(c,JSON.stringify(this.user_settings)),r.StandardToasts.makeStandardToast(this,r.StandardToasts.SUCCESS_UPDATE)})).catch((e=>{this.currently_updating=!1,r.StandardToasts.makeStandardToast(this,r.StandardToasts.FAIL_UPDATE,e)}))},getData:function(){return this.isStaleOrEmpty?this.refreshFromAPI():this.data},getStaleData:function(){return this.data},isStale(){return null===this.updated_at||new Date-this.updated_at>l},isEmpty(){return null===this.data},isStaleOrEmpty(){return this.isStale()||this.isEmpty()},updateIfStaleOrEmpty(){if(this.isStaleOrEmpty)return this.refreshFromAPI()},refreshFromAPI(){let e=new a.ApiApiFactory;if(!this.currently_updating)return this.currently_updating=!0,e.retrieveUserPreference(localStorage.getItem("USER_ID")).then((e=>(this.data=e.data,this.updated_at=new Date,this.currently_updating=!1,this.user_settings=e.data,this.user_settings_loaded_at=new Date,this.data))).catch((e=>{this.currently_updating=!1}))}}})},81930:function(e,t,s){s.r(t),s.d(t,{default:function(){return u}});var i=function(){var e=this,t=e._self._c;return t("div",[t("b-button-group",{staticClass:"w-100 mt-1"},[t("b-button",{attrs:{variant:"outline-info",disabled:e.disable},on:{click:function(t){return e.updateNumber("half")}}},[t("i",{staticClass:"fas fa-divide"}),e._v(" 2 ")]),t("b-button",{attrs:{variant:"outline-info",disabled:e.disable},on:{click:function(t){return e.updateNumber("sub")}}},[t("i",{staticClass:"fas fa-minus"})]),t("b-button",{attrs:{variant:"outline-info",disabled:e.disable},on:{click:function(t){return e.updateNumber("prompt")}}},[e._v(" "+e._s(e.number)+" ")]),t("b-button",{attrs:{variant:"outline-info",disabled:e.disable},on:{click:function(t){return e.updateNumber("add")}}},[t("i",{staticClass:"fas fa-plus"})]),t("b-button",{attrs:{variant:"outline-info",disabled:e.disable},on:{click:function(t){return e.updateNumber("multiply")}}},[t("i",{staticClass:"fas fa-times"}),e._v(" 2 ")])],1)],1)},a=[],n=s(70538),r=s(12120);s(57024);n["default"].use(r.XG7);var l={name:"NumberScalerComponent",props:{number:{type:Number,default:0},disable:{type:Boolean,default:!1}},data(){return{}},methods:{updateNumber:function(e){if("half"===e&&this.$emit("change",this.number/2),"multiply"===e&&this.$emit("change",2*this.number),"add"===e&&this.$emit("change",this.number+1),"sub"===e&&this.$emit("change",this.number-1),"prompt"===e){let e=prompt(this.$t("Input"),this.number);null===e||""===e||isNaN(e)||isNaN(parseFloat(e))?console.log("Invalid number input in  prompt",e):this.$emit("change",parseFloat(e))}}}},o=l,d=s(1001),c=(0,d.Z)(o,i,a,!1,null,"267d35cc",null),u=c.exports},55905:function(e,t,s){s.r(t),s.d(t,{default:function(){return y}});var i=function(){var e=this,t=e._self._c;return!e.useUserPreferenceStore().device_settings.shopping_show_checked_entries&&e.is_checked||!e.useUserPreferenceStore().device_settings.shopping_show_delayed_entries&&e.is_delayed?e._e():t("div",{staticClass:"swipe-container",attrs:{id:e.item_container_id},on:{touchend:function(t){return e.handleSwipe()}}},[t("div",{staticClass:"swipe-action",class:{"bg-success":!e.is_checked,"bg-warning":e.is_checked}},[t("i",{staticClass:"swipe-icon fa-fw fas",class:{"fa-check":!e.is_checked,"fa-cart-plus":e.is_checked}})]),t("b-button-group",{staticClass:"swipe-element"},[e.is_delayed?t("b-button",{attrs:{variant:"primary"}},[t("i",{staticClass:"fa-fw fas fa-hourglass-half"})]):e._e(),t("div",{staticClass:"card flex-grow-1 btn-block p-2",on:{click:function(t){e.detail_modal_visible=!0}}},[t("div",{staticClass:"d-flex"},[Object.keys(e.amounts).length>0?t("div",{staticClass:"d-flex flex-column pr-2"},e._l(e.amounts,(function(s){return t("span",{key:s.id},[t("span",[s.checked&&!e.is_checked?t("i",{staticClass:"fas fa-check"}):e._e(),s.delayed&&!s.checked?t("i",{staticClass:"fas fa-hourglass-half"}):e._e(),e._v(" "),t("b",[e._v(e._s(s.amount)+" "+e._s(s.unit)+" ")])]),t("br")])})),0):e._e(),t("div",{staticClass:"d-flex flex-column flex-grow-1 align-self-center"},[e._v(" "+e._s(e.food.name)+" "),t("br"),e.info_row?t("span",[t("small",{staticClass:"text-muted"},[e._v(e._s(e.info_row))])]):e._e()])])]),t("b-button",{class:{"btn-success":!e.is_checked,"btn-warning":e.is_checked},attrs:{variant:"success"},on:{click:function(t){e.useShoppingListStore().setEntriesCheckedState(e.entries,!e.is_checked,!0)}}},[t("i",{staticClass:"d-print-none fa-fw fas",class:{"fa-check":!e.is_checked,"fa-cart-plus":e.is_checked}})])],1),e._m(0),t("b-modal",{attrs:{"body-class":"pr-4 pl-4 pt-0"},on:{hidden:function(t){e.detail_modal_visible=!1}},scopedSlots:e._u([{key:"modal-title",fn:function(){return[t("h5",[e._v(" "+e._s(e.food_row))]),t("small",{staticClass:"text-muted"},[e._v(e._s(e.food.description))])]},proxy:!0},{key:"default",fn:function(){return[t("h5",{staticClass:"mt-2"},[e._v(e._s(e.$t("Quick actions")))]),e._v(" "+e._s(e.$t("Category"))+" "),t("b-form-select",{staticClass:"form-control mb-2",attrs:{options:e.useShoppingListStore().supermarket_categories,"text-field":"name","value-field":"id"},on:{input:function(t){e.detail_modal_visible=!1,e.updateFoodCategory(e.food)}},model:{value:e.food.supermarket_category,callback:function(t){e.$set(e.food,"supermarket_category",t)},expression:"food.supermarket_category"}}),t("b-button",{attrs:{variant:"info",block:""},on:{click:function(t){e.detail_modal_visible=!1,e.useShoppingListStore().delayEntries(e.entries,!e.is_delayed,!0)}}},[e._v(" "+e._s(e.$t("Postpone"))+" ")]),t("h6",{staticClass:"mt-2"},[e._v(e._s(e.$t("Entries")))]),e._l(e.entries,(function(s){return t("b-row",{key:s.id},[t("b-col",{attrs:{cold:"12"}},[t("b-button-group",{staticClass:"w-100"},[t("div",{staticClass:"card flex-grow-1 btn-block p-2"},[t("span",[s.checked?t("i",{staticClass:"fas fa-check"}):e._e(),null===s.delay_until||s.checked?e._e():t("i",{staticClass:"fas fa-hourglass-half"}),t("b",[s.amount>0?t("span",[e._v(e._s(s.amount))]):e._e(),e._v(" "+e._s(s.unit?.name))]),e._v(" "+e._s(e.food.name))]),t("span",[t("small",{staticClass:"text-muted"},[s.recipe_mealplan&&""!==s.recipe_mealplan.recipe_name?t("span",[t("a",{attrs:{href:e.resolveDjangoUrl("view_recipe",s.recipe_mealplan.recipe)}},[t("b",[e._v(" "+e._s(s.recipe_mealplan.recipe_name)+" ")])]),e._v("("+e._s(s.recipe_mealplan.servings)+" "+e._s(e.$t("Servings"))+")"),t("br")]):e._e(),s.recipe_mealplan&&void 0!==s.recipe_mealplan.mealplan_type?t("span",[e._v(" "+e._s(s.recipe_mealplan.mealplan_type)+" "+e._s(e.formatDate(s.recipe_mealplan.mealplan_from_date))+" "),t("br")]):e._e(),e._v(" "+e._s(s.created_by.display_name)+" "+e._s(e.formatDate(s.created_at))),t("br")])])]),t("b-button",{attrs:{variant:"outline-danger"},on:{click:function(t){e.useShoppingListStore().deleteObject(s)}}},[t("i",{staticClass:"fas fa-trash"})])],1),null===s.recipe_mealplan?t("generic-multiselect",{staticClass:"mt-1",attrs:{initial_single_selection:s.unit,model:e.Models.UNIT,multiple:!1},on:{change:function(t){s.unit=t.val,e.useShoppingListStore().updateObject(s)}}}):e._e(),null===s.recipe_mealplan?t("number-scaler-component",{attrs:{number:s.amount},on:{change:function(t){s.amount=t,e.useShoppingListStore().updateObject(s)}}}):e._e(),t("hr",{staticClass:"m-2"})],1)],1)})),t("b-button",{attrs:{variant:"success",block:""},on:{click:function(t){e.useShoppingListStore().createObject({amount:0,unit:null,food:e.food})}}},[e._v(" "+e._s(e.$t("Add")))]),t("b-button",{attrs:{variant:"warning",block:""},on:{click:function(t){e.detail_modal_visible=!1,e.setFoodIgnoredAndChecked(e.food)}}},[e._v(" "+e._s(e.$t("Ignore_Shopping")))]),t("b-button",{staticClass:"mt-2",attrs:{variant:"danger",block:""},on:{click:function(t){e.detail_modal_visible=!1,e.useShoppingListStore().deleteEntries(e.entries)}}},[e._v(" "+e._s(e.$t("Delete_All"))+" ")])]},proxy:!0},{key:"modal-footer",fn:function(){return[t("span")]},proxy:!0}],null,!1,2124560217),model:{value:e.detail_modal_visible,callback:function(t){e.detail_modal_visible=t},expression:"detail_modal_visible"}}),t("generic-modal-form",{attrs:{model:e.Models.FOOD,show:null!==e.editing_food},on:{hidden:function(t){e.editing_food=null,e.useShoppingListStore().refreshFromAPI()}}})],1)},a=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"swipe-action bg-primary justify-content-end"},[t("i",{staticClass:"fa-fw fas fa-hourglass-half swipe-icon"})])}],n=(s(57658),s(70538)),r=s(12120),l=(s(57024),s(49665)),o=(s(15782),s(76488)),d=s(6955),c=s(81185),u=s(81930),_=s(45871),p=s(26678);n["default"].use(r.XG7);var h={name:"ShoppingLineItem",mixins:[l.ApiMixin,l.FormatMixin],components:{GenericMultiselect:p["default"],GenericModalForm:_["default"],NumberScalerComponent:u["default"]},props:{entries:{type:Object}},data(){return{detail_modal_visible:!1,editing_food:null}},computed:{item_container_id:function(){let e="id_sli_";for(let t in this.entries)e+=t+"_";return e},is_checked:function(){for(let e in this.entries)if(!this.entries[e].checked)return!1;return!0},is_delayed:function(){for(let e in this.entries)if(Date.parse(this.entries[e].delay_until)>new Date(Date.now()))return!0;return!1},food:function(){return this.entries[Object.keys(this.entries)[0]]["food"]},amounts:function(){let e={};for(let t in this.entries){let s=this.entries[t];if(!s.checked&&null===s.delay_until||s.checked&&(0,c.R)().device_settings.shopping_show_checked_entries||null!==s.delay_until&&(0,c.R)().device_settings.shopping_show_delayed_entries){let t=-1;void 0!==s.unit&&null!==s.unit&&(t=s.unit.id),s.amount>0&&(t in e?e[t]["amount"]+=s.amount:e[t]=-1===t?{id:-1,unit:"",amount:s.amount,checked:s.checked,delayed:null!==s.delay_until}:{id:s.unit.id,unit:s.unit.name,amount:s.amount,checked:s.checked,delayed:null!==s.delay_until})}}return e},food_row:function(){return this.food.name},info_row:function(){let e=[],t=[],s=[],i=[];for(let a in this.entries){let e=this.entries[a];if(-1===t.indexOf(e.created_by.display_name)&&t.push(e.created_by.display_name),null!==e.recipe_mealplan){let t=e.recipe_mealplan.recipe_name;if(-1===s.indexOf(t)&&s.push(t.substring(0,14)+(t.length>14?"..":"")),"mealplan_from_date"in e.recipe_mealplan){let t=(e?.recipe_mealplan?.mealplan_type||"")+" ("+this.formatDate(e.recipe_mealplan.mealplan_from_date)+")";-1===i.indexOf(t)&&i.push(t)}}}return(0,c.R)().device_settings.shopping_item_info_created_by&&t.length>0&&e.push(t.join(", ")),(0,c.R)().device_settings.shopping_item_info_recipe&&s.length>0&&e.push(s.join(", ")),(0,c.R)().device_settings.shopping_item_info_mealplan&&i.length>0&&e.push(i.join(", ")),e.join(" - ")}},watch:{},mounted(){},methods:{useUserPreferenceStore:c.R,useShoppingListStore:o.W,resolveDjangoUrl:l.resolveDjangoUrl,updateFoodCategory:function(e){"number"===typeof e.supermarket_category&&(e.supermarket_category=this.useShoppingListStore().supermarket_categories.filter((t=>t.id===e.supermarket_category))[0]);let t=new d.ApiApiFactory;t.updateFood(e.id,e).then((e=>{})).catch((e=>{l.StandardToasts.makeStandardToast(this,l.StandardToasts.FAIL_UPDATE,e)}))},setFoodIgnoredAndChecked:function(e){let t=new d.ApiApiFactory;e.ignore_shopping=!0,t.updateFood(e.id,e).then((e=>{})).catch((e=>{l.StandardToasts.makeStandardToast(this,l.StandardToasts.FAIL_UPDATE,e)})),(0,o.W)().setEntriesCheckedState(this.entries,!0,!1)},handleSwipe:function(){const e=80,t=document.querySelector("#"+this.item_container_id),s=t.scrollLeft-t.clientWidth;s<-1*e?(0,o.W)().setEntriesCheckedState(this.entries,!this.is_checked,!0):s>e&&(0,o.W)().delayEntries(this.entries,!this.is_delayed,!0)}}},f=h,m=s(1001),g=(0,m.Z)(f,i,a,!1,null,null,null),y=g.exports}}]);