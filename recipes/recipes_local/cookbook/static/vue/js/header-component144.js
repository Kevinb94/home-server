"use strict";(self["webpackChunktandoor"]=self["webpackChunktandoor"]||[]).push([[9289],{81185:function(e,t,s){s.d(t,{R:function(){return d}});var r=s(96086),n=s(6955),a=s(70538),i=s(49665);const o=3e4,_="user_preference_store",u="TANDOOR_LOCAL_SETTINGS",l="TANDOOR_USER_SETTINGS",c=localStorage.getItem("USER_ID"),d=(0,r.Q_)(_,{state:()=>({data:null,updated_at:null,currently_updating:!1,user_settings_loaded_at:new Date(0),user_settings:{image:null,theme:"TANDOOR",nav_bg_color:"#ddbf86",nav_text_color:"DARK",nav_show_logo:!0,default_unit:"g",default_page:"SEARCH",use_fractions:!1,use_kj:!1,plan_share:[],nav_sticky:!0,ingredient_decimals:2,comments:!0,shopping_auto_sync:5,mealplan_autoadd_shopping:!1,food_inherit_default:[],default_delay:"4.0000",mealplan_autoinclude_related:!0,mealplan_autoexclude_onhand:!0,shopping_share:[],shopping_recent_days:7,csv_delim:",",csv_prefix:"",filter_to_supermarket:!1,shopping_add_onhand:!1,left_handed:!1,show_step_ingredients:!0,food_children_exist:!1,locally_updated_at:new Date(0)},device_settings_initialized:!1,device_settings_loaded_at:new Date(0),device_settings:{shopping_show_checked_entries:!1,shopping_show_delayed_entries:!1,shopping_show_selected_supermarket_only:!1,shopping_selected_grouping:"food.supermarket_category.name",shopping_selected_supermarket:null,shopping_item_info_created_by:!1,shopping_item_info_mealplan:!1,shopping_item_info_recipe:!0}}),getters:{},actions:{loadDeviceSettings(){let e=localStorage.getItem(u);if(null!==e){let t=JSON.parse(e);for(e in t)a["default"].set(this.device_settings,e,t[e])}this.device_settings_initialized=!0},updateDeviceSettings:function(){localStorage.setItem(u,JSON.stringify(this.device_settings))},loadUserSettings:function(e){let t=localStorage.getItem(l);if(null!==t){let e=JSON.parse(t);for(t in e)a["default"].set(this.user_settings,t,e[t]);console.log(`loaded local user settings age ${((new Date).getTime()-this.user_settings.locally_updated_at)/1e3} `)}if((new Date).getTime()-this.user_settings.locally_updated_at>o||!e){console.log("refreshing user settings from API");let e=new n.ApiApiFactory;e.retrieveUserPreference(localStorage.getItem("USER_ID")).then((e=>{for(t in e.data)t in this.user_settings||"user"===t?a["default"].set(this.user_settings,t,e.data[t]):console.error(`API returned UserPreference key "${t}" which has no default in UserPreferenceStore.user_settings.`);a["default"].set(this.user_settings,"locally_updated_at",(new Date).getTime()),localStorage.setItem(l,JSON.stringify(this.user_settings))})).catch((e=>{this.currently_updating=!1}))}},updateUserSettings:function(){let e=new n.ApiApiFactory;e.partialUpdateUserPreference(c,this.user_settings).then((e=>{this.user_settings=e.data,a["default"].set(this.user_settings,"locally_updated_at",(new Date).getTime()),localStorage.setItem(l,JSON.stringify(this.user_settings)),i.StandardToasts.makeStandardToast(this,i.StandardToasts.SUCCESS_UPDATE)})).catch((e=>{this.currently_updating=!1,i.StandardToasts.makeStandardToast(this,i.StandardToasts.FAIL_UPDATE,e)}))},getData:function(){return this.isStaleOrEmpty?this.refreshFromAPI():this.data},getStaleData:function(){return this.data},isStale(){return null===this.updated_at||new Date-this.updated_at>o},isEmpty(){return null===this.data},isStaleOrEmpty(){return this.isStale()||this.isEmpty()},updateIfStaleOrEmpty(){if(this.isStaleOrEmpty)return this.refreshFromAPI()},refreshFromAPI(){let e=new n.ApiApiFactory;if(!this.currently_updating)return this.currently_updating=!0,e.retrieveUserPreference(localStorage.getItem("USER_ID")).then((e=>(this.data=e.data,this.updated_at=new Date,this.currently_updating=!1,this.user_settings=e.data,this.user_settings_loaded_at=new Date,this.data))).catch((e=>{this.currently_updating=!1}))}}})},64656:function(e,t,s){s.r(t),s.d(t,{default:function(){return d}});var r=function(){var e=this,t=e._self._c;return void 0!==e.useUserPreferenceStore().user_settings?t("div",[t("b-form-group",{attrs:{label:e.$t("shopping_share"),description:e.$t("shopping_share_desc")}},[t("generic-multiselect",{attrs:{model:e.Models.USER,initial_selection:e.useUserPreferenceStore().user_settings.shopping_share,label:"display_name",multiple:!0,placeholder:e.$t("User")},on:{change:function(t){e.useUserPreferenceStore().user_settings.shopping_share=t.val,e.updateSettings(!1)}}})],1),t("b-form-group",{attrs:{label:e.$t("shopping_auto_sync"),description:e.$t("shopping_auto_sync_desc")}},[t("b-form-input",{attrs:{type:"range",min:e.SHOPPING_MIN_AUTOSYNC_INTERVAL,max:"60",step:"1",disabled:e.useUserPreferenceStore().user_settings.shopping_auto_sync<1},on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.shopping_auto_sync,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"shopping_auto_sync",t)},expression:"useUserPreferenceStore().user_settings.shopping_auto_sync"}}),t("div",{staticClass:"text-center"},[e.useUserPreferenceStore().user_settings.shopping_auto_sync>0?t("span",[e._v(" "+e._s(Math.round(e.useUserPreferenceStore().user_settings.shopping_auto_sync))+" "),1===e.useUserPreferenceStore().user_settings.shopping_auto_sync?t("span",[e._v(e._s(e.$t("Second")))]):t("span",[e._v(" "+e._s(e.$t("Seconds")))])]):e._e(),e.useUserPreferenceStore().user_settings.shopping_auto_sync<1?t("span",[e._v(e._s(e.$t("Disable")))]):e._e()]),t("br"),e.useUserPreferenceStore().user_settings.shopping_auto_sync>0?t("b-button",{staticClass:"btn btn-sm",on:{click:function(t){e.useUserPreferenceStore().user_settings.shopping_auto_sync=0,e.updateSettings(!1)}}},[e._v(e._s(e.$t("Disable")))]):e._e(),e.useUserPreferenceStore().user_settings.shopping_auto_sync<1?t("b-button",{staticClass:"btn btn-sm btn-success",on:{click:function(t){e.useUserPreferenceStore().user_settings.shopping_auto_sync=e.SHOPPING_MIN_AUTOSYNC_INTERVAL,e.updateSettings(!1)}}},[e._v(e._s(e.$t("Enable")))]):e._e()],1),t("b-form-group",{attrs:{description:e.$t("mealplan_autoadd_shopping_desc")}},[t("b-form-checkbox",{on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.mealplan_autoadd_shopping,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"mealplan_autoadd_shopping",t)},expression:"useUserPreferenceStore().user_settings.mealplan_autoadd_shopping"}},[e._v(e._s(e.$t("mealplan_autoadd_shopping"))+" ")])],1),t("b-form-group",{attrs:{description:e.$t("mealplan_autoexclude_onhand_desc")}},[t("b-form-checkbox",{on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.mealplan_autoexclude_onhand,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"mealplan_autoexclude_onhand",t)},expression:"useUserPreferenceStore().user_settings.mealplan_autoexclude_onhand"}},[e._v(e._s(e.$t("mealplan_autoexclude_onhand"))+" ")])],1),t("b-form-group",{attrs:{description:e.$t("mealplan_autoinclude_related_desc")}},[t("b-form-checkbox",{on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.mealplan_autoinclude_related,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"mealplan_autoinclude_related",t)},expression:"useUserPreferenceStore().user_settings.mealplan_autoinclude_related"}},[e._v(e._s(e.$t("mealplan_autoinclude_related"))+" ")])],1),t("b-form-group",{attrs:{description:e.$t("shopping_add_onhand_desc")}},[t("b-form-checkbox",{on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.shopping_add_onhand,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"shopping_add_onhand",t)},expression:"useUserPreferenceStore().user_settings.shopping_add_onhand"}},[e._v(e._s(e.$t("shopping_add_onhand"))+" ")])],1),t("b-form-group",{attrs:{label:e.$t("default_delay"),description:e.$t("default_delay_desc")}},[t("b-form-input",{attrs:{type:"range",min:"1",max:"72",step:"1"},on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.default_delay,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"default_delay",t)},expression:"useUserPreferenceStore().user_settings.default_delay"}}),t("div",{staticClass:"text-center"},[t("span",[e._v(e._s(Math.round(e.useUserPreferenceStore().user_settings.default_delay))+" "),1===e.useUserPreferenceStore().user_settings.default_delay?t("span",[e._v(e._s(e.$t("Hour")))]):t("span",[e._v(" "+e._s(e.$t("Hours")))])])])],1),t("b-form-group",{attrs:{description:e.$t("filter_to_supermarket_desc")}},[t("b-form-checkbox",{on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.filter_to_supermarket,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"filter_to_supermarket",t)},expression:"useUserPreferenceStore().user_settings.filter_to_supermarket"}},[e._v(e._s(e.$t("filter_to_supermarket"))+" ")])],1),t("b-form-group",{attrs:{label:e.$t("shopping_recent_days"),description:e.$t("shopping_recent_days_desc")}},[t("b-form-input",{attrs:{type:"range",min:"0",max:"14",step:"1"},on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.shopping_recent_days,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"shopping_recent_days",t)},expression:"useUserPreferenceStore().user_settings.shopping_recent_days"}}),t("div",{staticClass:"text-center"},[t("span",[e._v(e._s(Math.round(e.useUserPreferenceStore().user_settings.shopping_recent_days))+" "),1===e.useUserPreferenceStore().user_settings.shopping_recent_days?t("span",[e._v(e._s(e.$t("Day")))]):t("span",[e._v(" "+e._s(e.$t("Days")))])])])],1),t("b-form-group",{attrs:{label:e.$t("csv_delim_label"),description:e.$t("csv_delim_help")}},[t("b-form-input",{on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.csv_delim,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"csv_delim",t)},expression:"useUserPreferenceStore().user_settings.csv_delim"}})],1),t("b-form-group",{attrs:{label:e.$t("csv_prefix_label"),description:e.$t("csv_prefix_help")}},[t("b-form-input",{on:{change:function(t){return e.updateSettings(!1)}},model:{value:e.useUserPreferenceStore().user_settings.csv_prefix,callback:function(t){e.$set(e.useUserPreferenceStore().user_settings,"csv_prefix",t)},expression:"useUserPreferenceStore().user_settings.csv_prefix"}})],1)],1):e._e()},n=[],a=s(49665),i=s(26678),o=s(81185),_={name:"ShoppingSettingsComponent",mixins:[a.ApiMixin],components:{GenericMultiselect:i["default"]},props:{},data(){return{user_preferences:void 0,SHOPPING_MIN_AUTOSYNC_INTERVAL:window.SHOPPING_MIN_AUTOSYNC_INTERVAL,languages:[]}},mounted(){this.languages=window.AVAILABLE_LANGUAGES,(0,o.R)().loadUserSettings(!1)},methods:{useUserPreferenceStore:o.R,updateSettings:function(e){this.$emit("updated",this.user_preferences),(0,o.R)().updateUserSettings()}}},u=_,l=s(1001),c=(0,l.Z)(u,r,n,!1,null,"71288b75",null),d=c.exports}}]);