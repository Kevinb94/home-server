(self["webpackChunktandoor"]=self["webpackChunktandoor"]||[]).push([[466,842],{80383:function(e,t,n){"use strict";n.d(t,{s:function(){return i},x:function(){return s}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"row"},[t("div",{staticClass:"col",staticStyle:{"text-align":"center"}},[t("img",{staticClass:"spinner-tandoor",style:{height:e.size+"vh"},attrs:{alt:"loading spinner",src:""}})])])},s=[]},15782:function(e,t,n){"use strict";n.d(t,{I:function(){return l}});n(57658);var i=n(6955),s=n(49665),a=n(96086),r=n(70538);const d="meal_plan_store",o="MEAL_PLAN_CLIENT_SETTINGS",l=(0,a.Q_)(d,{state:()=>({plans:{},currently_updating:null,settings:null}),getters:{plan_list:function(){let e=[];for(let t in this.plans)e.push(this.plans[t]);return e},empty_meal_plan:function(){return{from_date:null,to_date:null,id:-1,meal_type:null,note:"",note_markdown:"",recipe:null,servings:1,shared:[],title:"",title_placeholder:"Title"}},client_settings:function(){return null===this.settings&&(this.settings=this.loadClientSettings()),this.settings}},actions:{refreshFromAPI(e,t){if(null==this.currently_updating||this.currently_updating[0]!==e||this.currently_updating[1]!==t){this.currently_updating=[e,t];let n=new i.ApiApiFactory;n.listMealPlans(e,t).then((e=>{e.data.forEach((e=>{r["default"].set(this.plans,e.id,e)})),this.currently_updating=null}))}},createObject(e){let t=new i.ApiApiFactory;return t.createMealPlan(e).then((e=>(r["default"].set(this.plans,e.data.id,e.data),e))).catch((e=>{s.StandardToasts.makeStandardToast(this,s.StandardToasts.FAIL_CREATE,e)}))},updateObject(e){let t=new i.ApiApiFactory;return t.updateMealPlan(e.id,e).then((t=>{r["default"].set(this.plans,e.id,e)})).catch((e=>{s.StandardToasts.makeStandardToast(this,s.StandardToasts.FAIL_UPDATE,e)}))},deleteObject(e){let t=new i.ApiApiFactory;return t.destroyMealPlan(e.id).then((t=>{r["default"].delete(this.plans,e.id)})).catch((e=>{s.StandardToasts.makeStandardToast(this,s.StandardToasts.FAIL_DELETE,e)}))},updateClientSettings(e){this.settings=e,localStorage.setItem(o,JSON.stringify(this.settings))},loadClientSettings(){let e=localStorage.getItem(o);return null===e?{displayPeriodUom:"week",displayPeriodCount:3,startingDayOfWeek:1,displayWeekNumbers:!0}:JSON.parse(e)}}})},40841:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("tr",{staticClass:"ingredients__item"},[e.ingredient.is_header?[t("td",{staticClass:"ingredients__header-note header",attrs:{colspan:"5"},on:{click:e.done}},[t("b",[e._v(e._s(e.ingredient.note))])])]:[e.detailed?t("td",{staticClass:"ingredients__check d-print-none align-baseline py-2",on:{click:e.done}},[e.ingredient.checked?t("i",{staticClass:"ingredients__check ingredients__check_checked far fa-check-circle text-success"}):e._e(),e.ingredient.checked?e._e():t("i",{staticClass:"ingredients__check ingredients__check_checked_false far fa-check-circle text-primary"})]):e._e(),t("td",{staticClass:"ingredients__amount text-nowrap",on:{click:e.done}},[0===e.ingredient.amount||e.ingredient.no_amount?e._e():t("span",{staticClass:"ingredients__amount",class:e.amountClass,domProps:{innerHTML:e._s(e.amount)}})]),t("td",{staticClass:"ingredients__unit",on:{click:e.done}},[null===e.ingredient.unit||e.ingredient.no_amount?e._e():t("span",{class:e.unitClass},[e._v(e._s(e.unitName))])]),t("td",{staticClass:"ingredients__food",class:e.foodClass,on:{click:e.done}},[null!==e.ingredient.food?[null!==e.ingredient.food.recipe?t("a",{attrs:{href:e.resolveDjangoUrl("view_recipe",e.ingredient.food.recipe.id),target:"_blank",rel:"noopener noreferrer"}},[e._v(" "+e._s(e.foodName)+" ")]):""!==e.ingredient.food.url?t("a",{attrs:{href:e.ingredient.food.url,target:"_blank",rel:"noopener noreferrer"}},[e._v(" "+e._s(e.foodName))]):[t("span",{class:e.foodClass},[e._v(e._s(e.foodName))])]]:e._e()],2),e.detailed?t("td",{staticClass:"ingredients__note align-baseline"},[e.ingredient.note?[t("span",{directives:[{name:"b-popover",rawName:"v-b-popover.hover",value:e.ingredient.note,expression:"ingredient.note",modifiers:{hover:!0}}],staticClass:"ingredients__note ingredients__note_hover d-print-none touchable py-0 px-2"},[t("i",{staticClass:"far fa-comment"})]),t("div",{staticClass:"ingredients__note ingredients__note_print d-none d-print-block"},[t("i",{staticClass:"far fa-comment-alt d-print-none"}),e._v(" "+e._s(e.ingredient.note))])]:e._e()],2):e._e()]],2)},s=[],a=n(49665),r=n(70538),d=n(65284),o=n.n(d);r["default"].use(o());var l={name:"IngredientComponent",props:{ingredient:Object,ingredient_factor:{type:Number,default:1},detailed:{type:Boolean,default:!0}},mixins:[a.ResolveUrlMixin,a.EscapeCSSMixin],data(){return{checked:!1}},watch:{},mounted(){},computed:{amount:function(){return this.$sanitize((0,a.calculateAmount)(this.ingredient.amount,this.ingredient_factor))},isScaledUp:function(){return this.ingredient_factor>1},isScaledDown:function(){return this.ingredient_factor<1},amountClass:function(){return this.isScaledDown?this.escapeCSS("ingredients__amount_scaled_down"):this.isScaledUp?this.escapeCSS("ingredients__amount_scaled_up"):this.escapeCSS("ingredients__amount_scaled_false")},isUnitPlural:function(){return""!==this.ingredient.unit.plural_name&&null!==this.ingredient.unit.plural_name&&!!(this.ingredient.always_use_plural_unit||this.ingredient.amount*this.ingredient_factor>1)},isFoodPlural:function(){return null!=this.ingredient.food.plural_name&&""!==this.ingredient.food.plural_name&&(!!this.ingredient.always_use_plural_food||!this.ingredient.no_amount&&this.ingredient.amount*this.ingredient_factor>1)},unitClass:function(){return this.escapeCSS("_unitname-"+this.ingredient.unit.name)},foodClass:function(){return this.escapeCSS("_foodname-"+this.ingredient.food.name)},unitName:function(){return this.isUnitPlural?this.ingredient.unit.plural_name:this.ingredient.unit.name},foodName:function(){return this.isFoodPlural?this.ingredient.food.plural_name:this.ingredient.food.name}},methods:{done:function(){this.$emit("checked-state-changed",this.ingredient)}}},c=l,u=n(1001),p=(0,u.Z)(c,i,s,!1,null,"5ac4dfea",null),h=p.exports},57609:function(e,t,n){"use strict";n.r(t);var i=n(80383),s=n(34322),a=n(1001),r=(0,a.Z)(s.Z,i.s,i.x,!1,null,null,null);t["default"]=r.exports},92301:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return f}});var i=function(){var e=this,t=e._self._c;return t("div",[t("b-modal",{attrs:{"hide-footer":"",id:`shopping_${this.modal_id}`,"body-class":"p-3 pt-0 pt-md-3"},on:{show:e.loadRecipe},scopedSlots:e._u([{key:"modal-title",fn:function(){return[t("h5",[e._v(e._s(e.$t("Add_Servings_to_Shopping",{servings:e.recipe_servings})))])]},proxy:!0}])},[e.loading?t("loading-spinner"):e._e(),e.loading?e._e():t("div",{staticClass:"accordion",attrs:{role:"tablist"}},[t("b-card",{staticClass:"mb-1",attrs:{"no-body":""}},[t("b-card-header",{staticClass:"p-0",attrs:{"header-tag":"header",role:"tab"}},[t("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle.accordion-0",modifiers:{"accordion-0":!0}}],staticClass:"text-left",attrs:{block:"",variant:"outline-info"}},[e._v(e._s(e.recipe.name))])],1),t("b-collapse",{staticClass:"p-2",attrs:{id:"accordion-0",visible:"",accordion:"my-accordion",role:"tabpanel"}},[t("div",[t("table",{staticClass:"table table-sm mb-0"},e._l(e.steps.flatMap((e=>e.ingredients)),(function(n){return t("ingredient-component",{key:n.id,attrs:{detailed:!0,ingredient:n,ingredient_factor:e.ingredient_factor},on:{"checked-state-changed":function(t){return e.$set(n,"checked",!n.checked)}}})})),1)])]),e._l(e.related_recipes,(function(n){return[t("b-card",{key:n.recipe.id,staticClass:"mb-1",attrs:{"no-body":""}},[t("b-card-header",{staticClass:"p-1",attrs:{"header-tag":"header",role:"tab"}},[t("b-button",{directives:[{name:"b-toggle",rawName:"v-b-toggle",value:"accordion-"+n.recipe.id,expression:"'accordion-' + r.recipe.id"}],staticClass:"text-left",attrs:{"btn-sm":"",block:"",variant:"outline-primary"}},[e._v(e._s(n.recipe.name))])],1),t("b-collapse",{attrs:{id:"accordion-"+n.recipe.id,accordion:"my-accordion",role:"tabpanel"}},e._l(n.steps.flatMap((e=>e.ingredients)),(function(n){return t("div",{key:n.id},[t("table",{staticClass:"table table-sm mb-0"},[t("ingredient-component",{key:n.id,attrs:{detailed:!0,ingredient:n,ingredient_factor:e.ingredient_factor},on:{"checked-state-changed":function(t){return e.$set(n,"checked",!n.checked)}}})],1)])})),0)],1)]}))],2)],1),t("div",[t("b-input-group",[t("b-input-group-prepend",{staticClass:"d-inline-flex",attrs:{"is-text":""}},[t("i",{staticClass:"fa fa-calculator"})]),t("b-form-spinbutton",{staticStyle:{height:"3em"},attrs:{min:"1",inline:""},model:{value:e.recipe_servings,callback:function(t){e.recipe_servings=t},expression:"recipe_servings"}}),t("b-input-group-append",{staticClass:"d-inline-flex"},[t("b-button",{staticClass:"d-none d-lg-inline-block",attrs:{variant:"success"},on:{click:e.saveShopping}},[e._v(e._s(e.$t("Save")))]),t("b-button",{staticClass:"d-inline-block d-lg-none",attrs:{variant:"success"},on:{click:e.saveShopping}},[t("i",{staticClass:"fa fa-cart-plus"})])],1)],1)],1)],1)],1)},s=[],a=(n(57658),n(70538)),r=n(12120),d=n(49665),o=n(40841),l=n(57609),c=n(15782);a["default"].use(r.XG7);const{ApiApiFactory:u}=n(6955);var p={name:"ShoppingModal",components:{LoadingSpinner:l["default"],IngredientComponent:o["default"]},mixins:[],props:{recipe:{required:!0,type:Object},servings:{type:Number,default:void 0},modal_id:{required:!0,type:Number},mealplan:{type:Object,default:void 0},list_recipe:{type:Number,default:void 0}},data(){return{loading:!0,steps:[],recipe_servings:void 0,add_shopping:[],related_recipes:[]}},mounted(){this.recipe_servings=this.servings},computed:{ingredient_factor:function(){return this.recipe_servings/this.recipe.servings}},watch:{servings:function(e){this.recipe_servings=parseInt(e)}},methods:{loadRecipe:function(){this.add_shopping=[],this.related_recipes=[];let e=new u;e.retrieveRecipe(this.recipe.id).then((e=>{this.steps=e.data.steps,this.recipe_servings||(this.recipe_servings=e.data?.servings),this.steps.forEach((e=>e.ingredients.filter((e=>!1===e.food?.food_onhand)).forEach((e=>this.$set(e,"checked",!0))))),this.loading=!1})).then((()=>{e.relatedRecipe(this.recipe.id).then((e=>e.data)).then((t=>{let n=[];return t.forEach((t=>{n.push(e.listSteps(t.id).then((e=>{let n=e.data.results.filter((e=>e.ingredients.length>0));n.forEach((e=>e.ingredients.filter((e=>!1===e.food.food_onhand)).forEach((e=>this.$set(e,"checked",!0))))),this.related_recipes.push({recipe:t,steps:n})})))})),Promise.all(n)}))}))},saveShopping:function(){let e={id:this.recipe.id,ingredients:this.steps.flatMap((e=>e.ingredients.filter((e=>!0===e.checked)).flatMap((e=>e.id)))).concat(this.related_recipes.flatMap((e=>e.steps.flatMap((e=>e.ingredients.filter((e=>!0===e.checked)).flatMap((e=>e.id))))))),servings:this.recipe_servings,mealplan:this.mealplan,list_recipe:this.list_recipe},t=new u;t.shoppingRecipe(this.recipe.id,e).then((e=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.SUCCESS_CREATE),this.$emit("finish"),void 0!==this.mealplan&&null!==this.mealplan&&((0,c.I)().plans[this.mealplan.id].shopping=!0)})).catch((e=>{d.StandardToasts.makeStandardToast(this,d.StandardToasts.FAIL_CREATE,e)})),this.$bvModal.hide(`shopping_${this.modal_id}`)}}},h=p,_=n(1001),g=(0,_.Z)(h,i,s,!1,null,null,null),f=g.exports},34322:function(e,t,n){"use strict";var i=n(46969);t.Z=i.Z},46969:function(e,t){"use strict";t.Z={name:"LoadingSpinner",props:{recipe:Object,size:{type:Number,default:30}}}},22868:function(){},14777:function(){},99830:function(){},70209:function(){},87414:function(){}}]);